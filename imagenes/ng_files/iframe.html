<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0978)https://players.fichub.com/resources/iframe/iframe.html?data=dGVtcGxhdGU9bmdwZ3MtaWZyYW1lJTJGZGVmYXVsdCZjb3VudHJ5PUVTJnNpdGVfc2VjdGlvbl9pZD13d3cubmF0aW9uYWxnZW9ncmFwaGljLmVzJmF1dG9wbGF5PWZhbHNlJmlkPUxpZ2h0UG9sbHV0aW9uMTAxRVMxJnZpZGVvX2NhdGVnb3J5PU1lZGlvJTIwQW1iaWVudGUmY2hhbm5lbD0mcGdfcmF0aW5nPSZzaG93VGl0bGU9JnZpZGVvX3B1YmxpY2F0aW9uRGF0ZT0wMiUyRjA0JTJGMjAxOSZpbnN0YW5jZV9pZD0xJnBsYXllclVybD1odHRwcyUzQSUyRiUyRnd3dy5uYXRpb25hbGdlb2dyYXBoaWMuZXMlMkZtZWRpby1hbWJpZW50ZSUyRmRhdG9zLWRlbC1kaWEtZGUtbGEtdGllcnJhLXBvci1xdWUtc2UtY2VsZWJyYS1kb25kZS1lbXBlem8meWIuZGV2aWNlX29zPVdpbmRvd3MmbG9jYXRpb249aHR0cHMlM0ElMkYlMkZ3d3cubmF0aW9uYWxnZW9ncmFwaGljLmVzJTJGbWVkaW8tYW1iaWVudGUlMkZkYXRvcy1kZWwtZGlhLWRlLWxhLXRpZXJyYS1wb3ItcXVlLXNlLWNlbGVicmEtZG9uZGUtZW1wZXpvJmdhX3RpdGxlPURhdG9zJTIwZGVsJTIwRCVDMyVBRGElMjBkZSUyMGxhJTIwVGllcnJhJTNBJTIwJUMyJUJGUG9yJTIwcXUlQzMlQTklMjBzZSUyMGNlbGVicmElM0YlMjAlQzIlQkZEJUMzJUIzbmRlJTIwZW1wZXolQzMlQjMlM0YlMjAlN0MlMjBOYXRpb25hbCUyMEdlb2dyYXBoaWM=&b=20190404123821 -->
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:tp="http://player.theplatform.com/" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style>.tpPlayer .tpPlayerCard{position:absolute;color:#d8d8d8;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);text-align:left;}.tpPlayer .tpOverlayBackground{position:absolute;width:100%;height:100%;background:rgba(0,0,0,0.6);}.tpPreviewPlayer .tpCurrentTime{left:20px;top:20px;font-size:20px;color:#d8d8d8;text-shadow:0 0 3px #000000, 0 0 3px #000000, 0 0 3px #000000;}:-webkit-full-screen .tpPlayerCard>*{zoom:2;content:"a";}:-webkit-full-screen .tpRelatedHeader{zoom:2;content:"b";}:-webkit-full-screen .tpRelatedFooter{zoom:2;content:"c";}:-webkit-full-screen .tpRelatedItems{zoom:1;}.tpLineFade{width:100%;height:12px;position:absolute;bottom:0;right:0;background:-moz-linear-gradient(top, rgba(0,0,0,0.0) 0, rgba(0,0,0,1.0) 100%);background:-webkit-gradient(linear, left top, left bottom, color-stop(0, rgba(0,0,0,0.0)), color-stop(100%, rgba(0,0,0,1.0)));background:-webkit-linear-gradient(top, rgba(0,0,0,0.0) 0, rgba(0,0,0,1.0) 100%);background:-o-linear-gradient(top, rgba(0,0,0,0.0) 0, rgba(0,0,0,1.0) 100%);background:-ms-linear-gradient(top, rgba(0,0,0,0.0) 0, rgba(0,0,0,1.0) 100%);background:linear-gradient(to bottom, rgba(0,0,0,0.0) 0, rgba(0,0,0,1.0) 100%);filter:progid;}.tpOverlayCard{pointer-events:none !important;}.tpPlayerCard input[type="text"],.tpPlayerCard input[type="password"],.tpPlayerCard textarea,.tpPlayerCard .tpTextInput{color:#d8d8d8;border:1px solid #000000;background-color:#000000;margin:1px !important;padding:0;resize:none;-webkit-appearance:none;-webkit-border-radius:0;}.tpPlayerCard select{color:#d8d8d8;border:1px solid #000000;background-color:#000000;margin:1px !important;padding:0;resize:none;-webkit-border-radius:0;}.tpPlayer .tpPlayerCard a img{border:0;}.tpControlBackground{background:#000000;}.tpControlBorder{border-color:#000000;}.tpPlayerCard.tpMenuCard{text-align:center;background:none;}.tpPlayerCard.tpResumePlaybackCard{text-align:center;}.tpPlayerCard .tpMenuButtons{position:absolute;top:50%;width:100%;margin-top:-25px;font-size:0;}.tpMenuCard .tpMenuButtons .tpButton{width:50px;height:50px;margin-right:12px;}.tpMenuCard .tpMenuButtons .tpButton:last-child{margin-right:0;}.tpMenuCard .tpRelatedItems{position:absolute;bottom:0;left:0;}.tpMenuCard .tpMenuButtons.tpHasRelated{top:30%;}.tpRelatedItems{width:100%;height:40%;background:rgba(0,0,0,0.6);}.tpRelatedItems .tpRelatedHeader{text-align:left;height:25px;border-bottom:1px solid #000000;line-height:25px;}.tpRelatedItems .tpRelatedHeader .tpRange{float:right;margin-right:40px;}.tpRelatedItems .tpRelatedHeader .tpLabel{float:left;margin-left:39px;}.tpRelatedItems .tpRelatedPrevious{float:left;width:30px;height:30px;}.tpRelatedItems .tpRelatedNext{float:left;width:30px;height:30px;margin-left:10px;}.tpRelatedItems .tpRelatedTiles{float:left;display:inline-block;position:relative;}.tpRelatedItems .tpRelatedTiles .tpRelatedTile{display:inline-block;margin-left:10px;font-size:14px;overflow:hidden;position:relative;}.tpRelatedItems .tpRelatedTiles .tpRelatedTile img{border:1px solid #000000;}.tpRelatedTile .tpRelatedInfo{float:right;text-align:left;margin-left:4px;}.tpRelatedTile h4{margin:0;padding:0;font-size:14px;}.tpRelatedTile span{margin:0;padding:0;font-size:12px;}.tpRelatedItems .tpRelatedFooter{text-align:left;height:25px;line-height:25px;clear:both;margin-left:39px;white-space:nowrap;overflow:hidden;}a.tpButton,div.tpButton{display:inline-block;padding:0;margin:0;border:0;}.tpButton>span{display:inline-block;padding:2px 6px 2px 6px;}.tpResumePlaybackCard .tpMenuButtons .tpButton{width:100px;height:40px;}.tpInfoCard .tpCardBody{padding-bottom:26px !important;overflow:hidden;text-overflow:ellipsis;}.tpInfoCard .tpCardContent{height:100%;overflow:hidden;text-overflow:ellipsis;margin-left:4px;}.tpInfoCard .tpMediaPreview{margin-right:6px;margin-bottom:6px;}.tpInfoCard .tpMetaData>span{margin-bottom:4px;display:block;}.tpMetaData{font-size:14px;}.tpCardHeadline .tpTitle{font-size:16px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;margin-bottom:6px;margin-top:6px;}.tpMetaData .tpTitle{font-size:16px;}.tpInfoCard .tpCardExtras{font-size:14px;text-align:left;}.tpInfoCard .tpCopyright{position:absolute;bottom:6px;left:6px;font-size:11px;}.tpRssCard .tpCardForm{width:100%;height:100%;position:relative;float:left;}.tpCopyable::selection,.tpCopyable::-moz-selection{background:rgba(0,0,0,0.75);color:#000000;}.tpPlayerCard{position:relative;}.tpPlayerCard .tpCardHeader{height:26px;padding-left:4px;padding-right:4px;padding-top:0;position:relative;}.tpPlayerCard .tpCardBody{position:absolute;top:0;bottom:0;right:0;left:0;margin-top:25px;padding:2px;background:rgba(0,0,0,0.6);}.tpPlayerCard .tpCardBody .tpCardHeadline h3{margin-top:4px;margin-bottom:8px;font-size:16px;}.tpPlayerCard .tpCardHeader .tpCardTitle{position:absolute;top:2px;left:2px;right:0;line-height:22px;font-size:15px;font-weight:bolder;}.tpPlayerCard .tpCardHeader .tpCardTitle .tpIcon{margin-left:2px;margin-right:2px;width:22px;height:22px;}.tpPlayerCard .tpCardHeader .tpCardTabs{position:absolute;padding-top:3px;top:0;bottom:0;left:0;right:0;font-size:0;text-align:center;z-index:1;}.tpPlayerCard .tpCardHeader .tpCardTabs .tpNavButton{display:inline-block;margin:0;padding:0;width:30px;height:22px;font-size:auto;}.tpPlayerCard .tpCardHeader .tpCardClose{position:absolute;top:2px;right:6px;z-index:10;}.tpMediaPreview,.tpPreview{width:50%;height:50%;float:left;position:relative;top:0;left:0;background:#000000;overflow:hidden;}.tpPreviewPlayer{border:1px solid #000000;position:absolute;top:0;left:0;bottom:0;right:0;}.tpMediaPreview .tpMediaBorder{position:absolute;top:0;left:0;right:0;bottom:0;border:1px solid white;}.tpMediaPreview img{width:100%;height:auto;padding:0;}.tpCardForm{width:50%;height:50%;position:relative;float:left;}.tpCardForm>div{position:absolute;top:0;left:4px;right:4px;bottom:0;}.tpCardForm h4{margin-left:4px;margin-right:0;margin-bottom:2px;margin-top:4px;font-size:15px;font-weight:normal;color:#d8d8d8;}.tpCardForm input[type="text"],.tpCardForm textarea{width:100%;font-family:inherit;padding:0 0 0 2px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;height:auto;font-size:13px;}.tpCardForm ul{padding:2px;list-style:none;background-color:#000000;margin-top:0;margin-bottom:0;margin-left:0;margin-right:0;border:1px solid #000000;color:#d8d8d8;overflow-x:hidden;overflow-y:hidden;top:24px;bottom:30px;left:2px;right:0;position:absolute;}.tpCardForm .tpPostSiteList{padding:8px;bottom:0;margin:4px;overflow-x:hidden;overflow-y:hidden;}.tpCardForm .tpFormActions{position:absolute;bottom:0;right:0;}.tpCardForm ul li{float:left;font-size:13px;margin-bottom:8px;width:100%;word-wrap:break-word;}.tpCardForm .tpPostSiteList li{width:50%;white-space:nowrap;overflow-x:hidden;overflow-y:hidden;}.tpCardForm ul li a{color:#d8d8d8;text-decoration:none;}.tpCardForm ul li a:hover{text-decoration:underline;}.tpCardForm ul li img{vertical-align:bottom;margin-right:8px;}.tpCardExtras{float:left;width:100%;height:50%;margin:0;font-size:14px;text-align:center;position:relative;}.tpExcerptControls{position:absolute;left:50px;right:50px;top:0;bottom:0;height:30px;margin:auto;display:inline-block;}.tpExcerptInfo{position:absolute;left:20px;right:20px;top:0;bottom:50%;height:16px;margin:auto;display:inline-block;}.tpCardTitle .tpIcon{float:left;}.PlayerLabelFont{font-family: verdana, "helveticaNeue", Calibri, "Lucida Sans Unicode", "Lucida Grande", sans-serif;font-size: 14px; } .PlayerTitleFont{ font-family: "helveticaNeue", Calibri, "Lucida Sans Unicode", "Lucida Grande", sans-serif;font-size: 14px; font-weight: bold; color: #ffcc00; } .PlayerCountdownFont { font-family: "helveticaNeue", Calibri, "Lucida Sans Unicode", "Lucida Grande", sans-serif;font-size: 14px; font-weight: bold; } .tpExcerptInfo { padding-bottom: 19px; } 
.PlayerLabelFont { color : #d8d8d8; } 
.PlayerTitleFont { color : #d8d8d8; text-shadow: 1px 1px 1px #000000; } 
.PlayerCountdownFont { color : #d8d8d8; text-shadow: 1px 1px 1px #000000; } 
.PlayerControlLabelFont { color : #d8d8d8; } 
div.PlayerControlLabelHoverFont { color : #ffffff !important; } 
div.PlayerControlLabelSelectedFont { color : #000000 !important; } 
</style><link type="text/css" rel="stylesheet" href="./default.css" media="screen">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>POC</title>

    <script async="" src="./analytics.js.descarga"></script><script src="./jquery.min.js.descarga"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="./main.css">
    <script src="./sdk.js.descarga"></script>
    <script>

        /**
         * Function to get a object with values in query string
         * @returns {*}
         */
        function decodeParams() {
            //var urlParams = new URLSearchParams(window.location.search);

            var uri = decodeURIComponent(Base64.decode($.urlParam('data')));

            var chunks = uri.split('&');
            var params = Object();

            for (var i=0; i < chunks.length ; i++) {
                var chunk = chunks[i].split('=');
                if(chunk[0].search("\\[\\]") !== -1) {
                    if( typeof params[chunk[0]] === 'undefined' ) {
                        params[chunk[0]] = [chunk[1]];
                    } else {
                        params[chunk[0]].push(chunk[1]);
                    }
                }
                else {
                    params[chunk[0]] = chunk[1];
                }
            }

            return params;
        }

        /**
         * Function to check if any key of an object contains the character '.'
         * @param object
         * @returns {boolean}
         */
        function hasLevel(object) {

            for (var property in object) {
                if (object.hasOwnProperty(property)) {
                    if (property.indexOf(".") !== -1) {
                        return true;
                    }
                }
            }

            return false;
        }

        function getOptions(){

            var options = decodeParams();

            while (hasLevel(options)) {
                for (var key in options) {
                    if (options.hasOwnProperty(key)) {
                        var array_key = key.split(".");

                        if (array_key.length > 1) {
                            var last_key = array_key[array_key.length - 1];
                            var first_key = key.replace("." + last_key, "");

                            var new_object = {};

                            if (options.hasOwnProperty(first_key)) {
                                new_object = options[first_key];
                            }

                            new_object[last_key] = options[key];
                            options[first_key] = new_object;

                            delete options[key];
                        }
                    }
                }
            }

            return options;
        }

        $.urlParam = function(name){
            var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
            if (results==null){
                return null;
            }
            else{
                return decodeURI(results[1]) || 0;
            }
        }

    </script>

    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            border: 0;
            background-color: #222;
        }

        .player-container {
            width: 100%;
            height: 100%;
        }
    </style>
<meta name="tp:EnableExternalController" content="true"><meta name="tp:PreferredRuntimes" content="universal"><meta name="tp:PreferredFormats" content="M3U, MPEG4"><meta name="tp:initialize" content="false"><script type="text/javascript" src="./9F24D31DF6E231DFF2C25B54304086BE.cache.js.descarga"></script><link type="text/css" rel="stylesheet" href="./subtitles.css"><link type="text/css" rel="stylesheet" href="./share_video_svg.css"><style type="text/css" id="tpCategoryListLoading">.tpCategoryList > * { display: none !important; }</style><style type="text/css" id="tpHeaderLoading">.tpHeader > * { display: none !important; }</style><style type="text/css" id="tpClipInfoLoading">.tpClipInfo > * { display: none !important; }</style><style type="text/css" id="tpReleaseListLoading">.tpReleaseList > * { display: none !important; }</style><style type="text/css" id="tpSearchLoading">.tpSearch > * { display: none !important; }</style><style type="text/css" id="tpReleaseModelLoading">.tpReleaseModel > * { display: none !important; }</style><style type="text/css" id="tpNavigationLoading">.tpNavigation > * { display: none !important; }</style><style type="text/css" id="tpCategoryModelLoading">.tpCategoryModel > * { display: none !important; }</style><link type="text/css" rel="stylesheet" href="./style.css"><link type="text/css" rel="stylesheet" href="./related_videos.min.css"><script type="text/javascript" src="./freewheel.js.descarga"></script><script charset="utf-8" type="text/javascript" src="./AdManager.js.descarga"></script><script type="text/javascript" src="./sp.min.js.descarga"></script></head>
<body style=""><div style="display:none" id="playerCards"><div id="adidasSubtitlesCard">
</div></div>

<div id="player-container" class="player-container">
    
<script>
    var youbora_plugin_1 = false;
    var player_check_age_verification_1 = false;
</script>


<script>
    function sdk_logger_info(message, trace) {
        if (typeof SDKLogger != 'undefined') {
            SDKLogger.info('1', message, trace);
        }
    }

    function sdk_logger_warn(message) {
        if (typeof SDKLogger != 'undefined') {
            SDKLogger.warn('1', message);
        }
    }

    function sdk_logger_error(message, trace) {
        if (typeof SDKLogger != 'undefined') {
            SDKLogger.error('1', message, trace);
        }
    }
</script>

<style>

    .ng-video-player-container {
        line-height:40px !important;
    }
    .player-holder {
        width: 100%;
        height: 100%;
    }

    #player-1 {
        width: 100%;
        height: 100%;
    }
</style>

<div class="player-holder">
    
    
    <div id="player-1" class="tpPlayer" style=""><div class="tpBackground" style="background-color: #000000; border-color: #626262"></div><div class="player" id="player71218">  <div class="tpVideo" id="player71218.player" style="z-index: 795; position: absolute; width: 100%; height: 100%; overflow: hidden;"><div id="player71218.content" style="width: 836px; height: 469px; background-color: rgb(0, 0, 0); padding: 0px; margin: 0px; top: 1px; left: 1px; position: absolute;"><video src="blob:https://players.fichub.com/9ae1bf73-bb72-4294-958f-c889dfc2fbb7" playsinline="" style="height: 100%; width: 100%;"></video></div></div>  <div class="tpVideoBlocker" id="player71218.controlBlocker" style="z-index: 796; position: absolute; background-color: transparent; height: 100%; width: 100%; overflow: hidden;"><a style="width: 100%; height: 100%; background: transparent; display: block; cursor: default;"></a></div>  <div class="tpPlugins" id="player71218.plugins" style="z-index: 797; position: absolute; width: 100%;"><div id="fw-pdk-plugin-video-display-base" style="width: 836px; height: 419px; z-index: 10000; cursor: pointer; display: none;"></div></div>  <div class="tpBlocker" id="player71218.blocker" style="z-index: 798; position: absolute; background-color: rgb(0, 0, 0); overflow: hidden; height: 469px; width: 836px; display: none; top: 1px; left: 1px;"></div>  <div id="player71218.standby" style="width: 836px; height: 469px; position: absolute; z-index: 800; overflow: hidden; pointer-events: none; left: 1px; top: 1px; display: block;"><img class="preview" style="display: none; position: absolute; top: 0px; left: 0px; width: 100%; height: auto;"><div id="player71218.standby.playButtonHolder" style="position: absolute; width: 836px; height: 469px; pointer-events: none; display: none; top: 50%; left: 50%;"><canvas style="opacity: 0.7; cursor: pointer; pointer-events: all; display: block;"></canvas></div><div class="tpLoadingIndicator" aria-hidden="true" style="pointer-events: none; user-select: none; cursor: default; width: 100%; height: 100%; display: none;"><canvas width="34" height="34" class="PlayerLoadingIndicatorSkin" style="display: block; width: 34px; height: 34px; position: absolute; z-index: 500; left: 50%; margin-left: -17px; top: 50%; margin-top: -17px; transform: rotate(30deg);"></canvas></div></div><div class="tpSubtitles" id="player71218.subtitles" style="pointer-events: none; z-index: 799; position: relative;"><div style="position: absolute; overflow: hidden; left: 2px; top: 1px; width: 834px; height: 419px;"></div></div>  <div class="tpCards" id="player71218.cards" style="pointer-events: none; z-index: 803; user-select: text; position: absolute; visibility: hidden; width: 838px; height: 471px;"><div style="position: absolute; overflow: hidden; left: 1px; top: 1px; width: 836px; height: 469px;"></div><div style="position: absolute; overflow: hidden; left: 1px; top: 1px; width: 836px; height: 419px;"></div><div id="unmuteCard_scope_1" class="tpPlayerCard unmute" style="opacity: 1; position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; pointer-events: auto; visibility: visible;"><img src="./volume-off.png"></div><div id="shareVideoCard" class="tpPlayerCard shareVideoCard" style="opacity: 1; position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; pointer-events: auto; visibility: visible; zoom: 1;"><ul class="social_media_right" style="display: none;"><li class="icon"><a class="fb-xfbml-parse-ignore" target="_blank" onclick="return !window.open(this.href, &#39;&#39;, &#39;width=500,height=500&#39;)" href="https://www.facebook.com/sharer/sharer.php?u=https://www.nationalgeographic.es/medio-ambiente/datos-del-dia-de-la-tierra-por-que-se-celebra-donde-empezo"><img id="facebook_icon_1" class="facebook_icon facebook socialIcon fb-share-button" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></a></li><li class="icon_tw"><a class="fb-xfbml-parse-ignore" target="_blank" onclick="return !window.open(this.href, &#39;&#39;, &#39;width=500,height=500&#39;)" href="https://twitter.com/intent/tweet?text=Contaminaci%C3%B3n%20lum%C3%ADnica%20101%20https://www.nationalgeographic.es/medio-ambiente/datos-del-dia-de-la-tierra-por-que-se-celebra-donde-empezo%20via%20@natgeoespana"><img id="twitter_icon_1" class="twitter_icon twitter socialIcon" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></a></li><li class="icon_em"><img id="embed_icon_1" class="embed_icon embed socialIcon" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></li></ul><div id="panel_share_1" class="panel_share"><div class="share_close"><img id="close_icon_1" class="close_icon" src="./close_icon_white.svg"></div><div class="embed_video"><h5>COMPARTIR</h5><ul class="social_media" style="display: none;"><li class="icon"><a class="fb-xfbml-parse-ignore" target="_blank" onclick="return !window.open(this.href, &#39;&#39;, &#39;width=500,height=500&#39;)" href="https://www.facebook.com/sharer/sharer.php?u=https://www.nationalgeographic.es/medio-ambiente/datos-del-dia-de-la-tierra-por-que-se-celebra-donde-empezo"><img src="./facebook_icon_white.svg" id="facebook_icon_panel_1" class="facebook_icon_panel facebook socialIcon fb-share-button"></a></li><li class="icon_tw"><a class="fb-xfbml-parse-ignore" target="_blank" onclick="return !window.open(this.href, &#39;&#39;, &#39;width=500,height=500&#39;)" href="https://twitter.com/intent/tweet?text=Contaminaci%C3%B3n%20lum%C3%ADnica%20101%20https://www.nationalgeographic.es/medio-ambiente/datos-del-dia-de-la-tierra-por-que-se-celebra-donde-empezo%20via%20@natgeoespana"><img src="./twitter_icon_white.svg" id="twitter_icon_panel_1" class="twitter_icon_panel twitter socialIcon"></a></li></ul></div><h6>INSERTAR VIDEO</h6><form><input id="embed_code_1" type="text" value="&lt;div style=&#39;display: block; position: relative; height: 100%;&#39;&gt;&lt;div&gt;&lt;iframe src=&#39;https://players.fichub.com/resources/iframe/1.0.html?data=dGVtcGxhdGU9bmdwZ3MtaWZyYW1lJTJGZGVmYXVsdCZjb3VudHJ5PUVTJnNpdGVfc2VjdGlvbl9pZD13d3cuZXMuZW1iZWRkZWQmYXV0b3BsYXk9ZmFsc2UmaWQ9TGlnaHRQb2xsdXRpb24xMDFFUzEmdmlkZW9fY2F0ZWdvcnk9TWVkaW8rQW1iaWVudGUmY2hhbm5lbD0mcGdfcmF0aW5nPSZzaG93VGl0bGU9JnZpZGVvX3B1YmxpY2F0aW9uRGF0ZT0wMiUyRjA0JTJGMjAxOSZpbnN0YW5jZV9pZD0xJnBsYXllclVybD1odHRwcyUzQSUyRiUyRnBsYXllcnMuZmljaHViLmNvbSUyRnJlc291cmNlcyUyRmlmcmFtZSUyRmlmcmFtZS5odG1sJTNGZGF0YSUzRGRHVnRjR3hoZEdVOWJtZHdaM010YVdaeVlXMWxKVEpHWkdWbVlYVnNkQ1pqYjNWdWRISjVQVVZUSm5OcGRHVmZjMlZqZEdsdmJsOXBaRDEzZDNjdWJtRjBhVzl1WVd4blpXOW5jbUZ3YUdsakxtVnpKbUYxZEc5d2JHRjVQV1poYkhObEptbGtQVXhwWjJoMFVHOXNiSFYwYVc5dU1UQXhSVk14Sm5acFpHVnZYMk5oZEdWbmIzSjVQVTFsWkdsdkpUSXdRVzFpYVdWdWRHVW1ZMmhoYm01bGJEMG1jR2RmY21GMGFXNW5QU1p6YUc5M1ZHbDBiR1U5Sm5acFpHVnZYM0IxWW14cFkyRjBhVzl1UkdGMFpUMHdNaVV5UmpBMEpUSkdNakF4T1NacGJuTjBZVzVqWlY5cFpEMHhKbkJzWVhsbGNsVnliRDFvZEhSd2N5VXpRU1V5UmlVeVJuZDNkeTV1WVhScGIyNWhiR2RsYjJkeVlYQm9hV011WlhNbE1rWnRaV1JwYnkxaGJXSnBaVzUwWlNVeVJtUmhkRzl6TFdSbGJDMWthV0V0WkdVdGJHRXRkR2xsY25KaExYQnZjaTF4ZFdVdGMyVXRZMlZzWldKeVlTMWtiMjVrWlMxbGJYQmxlbThtZVdJdVpHVjJhV05sWDI5elBWZHBibVJ2ZDNNbWJHOWpZWFJwYjI0OWFIUjBjSE1sTTBFbE1rWWxNa1ozZDNjdWJtRjBhVzl1WVd4blpXOW5jbUZ3YUdsakxtVnpKVEpHYldWa2FXOHRZVzFpYVdWdWRHVWxNa1prWVhSdmN5MWtaV3d0WkdsaExXUmxMV3hoTFhScFpYSnlZUzF3YjNJdGNYVmxMWE5sTFdObGJHVmljbUV0Wkc5dVpHVXRaVzF3WlhwdkptZGhYM1JwZEd4bFBVUmhkRzl6SlRJd1pHVnNKVEl3UkNWRE15VkJSR0VsTWpCa1pTVXlNR3hoSlRJd1ZHbGxjbkpoSlROQkpUSXdKVU15SlVKR1VHOXlKVEl3Y1hVbFF6TWxRVGtsTWpCelpTVXlNR05sYkdWaWNtRWxNMFlsTWpBbFF6SWxRa1pFSlVNekpVSXpibVJsSlRJd1pXMXdaWG9sUXpNbFFqTWxNMFlsTWpBbE4wTWxNakJPWVhScGIyNWhiQ1V5TUVkbGIyZHlZWEJvYVdNJTNEJTI2YiUzRDIwMTkwNDA0MTIzODIxJmxvY2F0aW9uPWh0dHBzJTNBJTJGJTJGd3d3Lm5hdGlvbmFsZ2VvZ3JhcGhpYy5lcyUyRm1lZGlvLWFtYmllbnRlJTJGZGF0b3MtZGVsLWRpYS1kZS1sYS10aWVycmEtcG9yLXF1ZS1zZS1jZWxlYnJhLWRvbmRlLWVtcGV6byZnYV90aXRsZT1EYXRvcytkZWwrRCVDMyVBRGErZGUrbGErVGllcnJhJTNBKyVDMiVCRlBvcitxdSVDMyVBOStzZStjZWxlYnJhJTNGKyVDMiVCRkQlQzMlQjNuZGUrZW1wZXolQzMlQjMlM0YrJTdDK05hdGlvbmFsK0dlb2dyYXBoaWM=&#39; allowfullscreen webkitallowfullscreen mozallowfullscreen style=&#39;width: 100%; height: 100%; position: absolute; top: 0px; bottom: 0px; right: 0px; left: 0px;&#39;&gt; &lt;/iframe&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&#39;display:none&#39;&gt;&lt;a href=&#39;http://www.nationalgeographic.com.es/videos&#39;&gt;&lt;/a&gt;&lt;/div&gt;" readonly=""></form><div class="button" id="copy_button_1">COPIAR</div></div></div></div>  <div class="tpOverlays" id="player71218.overlays" style="z-index:802;top:0px;left:0px;pointer-events:none;position:absolute"></div>  <div class="tpControls controlsLayer" id="player71218.controls" style="z-index: 801; top: 0px; left: 0px; pointer-events: none; position: absolute; background-color: transparent; float: left; width: 100%; height: 100%;"><div style="position: relative; overflow: hidden; pointer-events: none; user-select: none; cursor: default; opacity: 1; width: 100%; height: 100%;"><div class="tpRegionContainer" style="position: absolute; overflow: hidden; width: 836px; height: 469px; left: 1px; top: 1px;"><div class="LinkedContainer" style="position: absolute; overflow: hidden; pointer-events: none; top: 0px; left: 0px; bottom: 0px; right: 0px; width: 836px; height: 469px;"><div class="tpRegion" aria-hidden="true" style="position: absolute; overflow: hidden; height: 0px; pointer-events: inherit; user-select: none; cursor: default; z-index: 1; opacity: 1; width: 0px; left: 0px; top: 0px; display: none;"><div class="tpRow" style="position: absolute; overflow: hidden; pointer-events: inherit; user-select: none; cursor: default; left: 0px; top: 0px; height: 30px;"><canvas width="0" height="0" class="PlayerTitleSkin" style="display: block; width: 0px; height: 0px; position: absolute; left: 0px; top: 0px;"></canvas><table cellspacing="0" cellpadding="0" style="margin-right: auto; margin-left: auto; position: absolute; pointer-events: auto; user-select: none; cursor: default; left: 0px; top: 2px;"><tbody><tr><td align="left" style="vertical-align: middle;"><div class="PlayerTitleFont" unselectable="on" style="padding-left: 2px; padding-right: 2px; line-height: 100%; white-space: nowrap;"></div></td></tr></tbody></table></div></div><div style="position: absolute; overflow: hidden; left: 0px; top: 0px; width: 836px; height: 469px;"><div class="LinkedContainer" style="position: absolute; overflow: hidden; pointer-events: none; top: 0px; left: 0px; bottom: 0px; right: 0px; width: 836px; height: 469px;"><div class="tpRegion" style="position: absolute; overflow: hidden; height: 50px; pointer-events: inherit; user-select: none; cursor: default; z-index: 1; opacity: 0; width: 836px; left: 0px; top: 419px;"><div class="tpRow" style="position: absolute; overflow: hidden; pointer-events: inherit; user-select: none; cursor: default; left: 0px; top: 0px; width: 836px; height: 50px;"><canvas width="836" height="50" class="RowSkin" style="display: block; width: 836px; height: 50px; position: absolute; left: 0px; top: 0px;"></canvas><div class="tpGroup" style="position: absolute; overflow: hidden; height: 40px; pointer-events: auto; user-select: none; cursor: default; width: 816px; left: 10px; top: 4px;"><canvas width="816" height="40" class="GroupSkin" style="display: block; width: 816px; height: 40px; position: absolute; left: 0px; top: 0px;"></canvas><div class="tpPlay" style="position: absolute; overflow: visible; pointer-events: auto; user-select: none; cursor: pointer; width: 32px; height: 32px; display: block; left: 0px; top: 4px;"><canvas width="32" height="32" class="ButtonSkin" style="display: block; width: 32px; height: 32px; position: absolute; left: 0px; top: 0px;"></canvas><table cellspacing="0" cellpadding="0" style="position: relative; left: 0px; top: 0px; margin-right: auto; margin-left: auto; height: 32px;"><tbody><tr><td align="center" style="vertical-align: middle;"><canvas width="32" height="32" class="IconPause" style="display: block; width: 32px; height: 32px;"></canvas></td></tr></tbody></table></div><div class="undefined" style="position: absolute; overflow: hidden; pointer-events: auto; user-select: none; cursor: default; width: 10px; height: 4px; left: 32px; top: 18px;"></div><div class="tpScrubber" style="position: absolute; overflow: hidden; pointer-events: auto; user-select: none; cursor: pointer; width: 453px; height: 3px; left: 42px; top: 19px;"><canvas width="453" height="3" class="ScrubberSkin" style="display: block; width: 453px; height: 3px; position: absolute; left: 0px; top: 0px;"></canvas><div style="position: relative; overflow: hidden; pointer-events: auto; user-select: none; cursor: default; width: 453px; height: 3px;"><div style="position: absolute; overflow: hidden; left: 0px; top: 0px; width: 453px; height: 3px;"><canvas width="437" height="3" class="ScrubberTrackSkin" style="display: block; width: 437px; height: 3px; position: absolute; left: 8px; top: 0px;"></canvas></div><div style="position: absolute; overflow: hidden; left: 0px; top: 0px; width: 453px; height: 3px;"><canvas width="437" height="4" class="ScrubberLoadedSkin" style="display: block; width: 437px; height: 4px; position: absolute; left: 8px; top: -1px;"></canvas></div><div style="position: absolute; overflow: hidden; left: 0px; top: 0px; width: 453px; height: 3px;"><canvas width="217" height="3" class="ScrubberProgressSkin" style="display: block; width: 217px; height: 3px; position: absolute; left: 8px; top: 0px;"></canvas></div><div style="position: absolute; overflow: hidden; left: 0px; top: 0px; width: 453px; height: 3px;"><canvas width="15" height="15" class="ScrubberThumbSkin" style="display: block; width: 15px; height: 15px; position: absolute; left: 219px; top: -6px;"></canvas></div><div style="position: absolute; overflow: hidden; left: 0px; top: 0px; width: 453px; height: 3px;"></div><div style="position: absolute; overflow: hidden; background-color: black; opacity: 0.01; z-index: 60; left: 0px; top: 0px; width: 453px; height: 3px;"></div></div></div><div class="undefined" style="position: absolute; overflow: hidden; pointer-events: auto; user-select: none; cursor: default; width: 10px; height: 4px; left: 495px; top: 18px;"></div><table cellspacing="0" cellpadding="0" style="margin-right: auto; margin-left: auto; position: absolute; pointer-events: auto; user-select: none; cursor: default; left: 505px; top: 13px;"><tbody><tr><td align="left" style="vertical-align: middle;"><div class="PlayerLabelFont" unselectable="on" style="padding-left: 2px; padding-right: 2px; line-height: 14px; white-space: nowrap; font-size: 14px;">1:21</div></td></tr></tbody></table><table cellspacing="0" cellpadding="0" style="margin-right: auto; margin-left: auto; position: absolute; pointer-events: auto; user-select: none; cursor: default; left: 543px; top: 13px;"><tbody><tr><td align="left" style="vertical-align: middle;"><div class="PlayerLabelFont" unselectable="on" style="padding-left: 2px; padding-right: 2px; line-height: 14px; white-space: nowrap; font-size: 14px;"> / </div></td></tr></tbody></table><table cellspacing="0" cellpadding="0" style="margin-right: auto; margin-left: auto; position: absolute; pointer-events: auto; user-select: none; cursor: default; left: 554px; top: 13px;"><tbody><tr><td align="left" style="vertical-align: middle;"><div class="PlayerLabelFont" unselectable="on" style="padding-left: 2px; padding-right: 2px; line-height: 14px; white-space: nowrap; font-size: 14px;">2:44</div></td></tr></tbody></table><div class="undefined" style="position: absolute; overflow: hidden; pointer-events: auto; user-select: none; cursor: default; width: 10px; height: 4px; left: 592px; top: 18px;"></div><div class="tpMute" style="position: absolute; overflow: visible; pointer-events: auto; user-select: none; cursor: pointer; width: 32px; height: 32px; display: block; left: 602px; top: 4px;"><canvas width="32" height="32" class="ButtonSkin" style="display: block; width: 32px; height: 32px; position: absolute; left: 0px; top: 0px;"></canvas><table cellspacing="0" cellpadding="0" style="position: relative; left: 0px; top: 0px; margin-right: auto; margin-left: auto; height: 32px;"><tbody><tr><td align="center" style="vertical-align: middle;"><canvas width="32" height="32" class="IconMuted" style="display: block; width: 32px; height: 32px;"></canvas></td></tr></tbody></table></div><div class="undefined" style="position: absolute; overflow: hidden; pointer-events: auto; user-select: none; cursor: default; width: 10px; height: 4px; left: 634px; top: 18px;"></div><div class="tpVolumeSlider" style="position: absolute; overflow: hidden; pointer-events: auto; user-select: none; cursor: pointer; width: 88px; height: 13px; left: 644px; top: 14px;"><canvas width="88" height="13" class="VolumeSkin" style="display: block; width: 88px; height: 13px; position: absolute; left: 0px; top: 0px;"></canvas><div style="position: relative; overflow: hidden; pointer-events: auto; user-select: none; cursor: default; width: 88px; height: 13px;"><div style="position: absolute; overflow: hidden; left: 0px; top: 0px; width: 88px; height: 13px;"><canvas width="88" height="13" class="VolumeTrackSkin" style="display: block; width: 88px; height: 13px; position: absolute; left: 0px; top: 0px;"></canvas><div class="undefined" style="position: absolute; overflow: visible; pointer-events: auto; user-select: none; cursor: pointer; width: 0px; height: 0px; left: 88px; top: 6px;"><canvas width="0" height="0" class="IconVolumePlus" style="display: block; width: 0px; height: 0px; position: absolute; left: 0px; top: 0px;"></canvas><table cellspacing="0" cellpadding="0" style="position: relative; left: 0px; top: 0px; margin-right: auto; margin-left: auto; height: 0px;"><tbody><tr></tr></tbody></table></div><div class="undefined" style="position: absolute; overflow: visible; pointer-events: auto; user-select: none; cursor: pointer; width: 0px; height: 0px; left: 0px; top: 6px;"><canvas width="0" height="0" class="IconVolumeMinus" style="display: block; width: 0px; height: 0px; position: absolute; left: 0px; top: 0px;"></canvas><table cellspacing="0" cellpadding="0" style="position: relative; left: 0px; top: 0px; margin-right: auto; margin-left: auto; height: 0px;"><tbody><tr></tr></tbody></table></div></div><div style="position: absolute; overflow: hidden; left: 0px; top: 0px; width: 88px; height: 13px;"><canvas width="0" height="3" class="VolumeProgressSkin" style="display: block; width: 0px; height: 3px; position: absolute; left: 0px; top: 5px;"></canvas></div><div style="position: absolute; overflow: hidden; left: 0px; top: 0px; width: 88px; height: 13px;"><canvas width="15" height="15" class="VolumeThumbSkin" style="display: block; width: 15px; height: 15px; position: absolute; left: 0px; top: -1px;"></canvas></div><div style="position: absolute; overflow: hidden; background-color: black; opacity: 0.01; z-index: 60; left: 0px; top: 0px; width: 88px; height: 13px;"></div></div></div><div class="undefined" style="position: absolute; overflow: hidden; pointer-events: auto; user-select: none; cursor: default; width: 10px; height: 4px; left: 732px; top: 18px;"></div><div class="tpButton" style="position: absolute; overflow: visible; pointer-events: auto; user-select: none; cursor: pointer; width: 32px; height: 32px; display: block; left: 742px; top: 4px;"><canvas width="32" height="32" class="ButtonSkin" style="display: block; width: 32px; height: 32px; position: absolute; left: 0px; top: 0px;"></canvas><table cellspacing="0" cellpadding="0" style="position: relative; left: 0px; top: 0px; margin-right: auto; margin-left: auto; height: 32px;"><tbody><tr><td align="center" style="vertical-align: middle;"><canvas width="32" height="32" class="IconCC" style="display: block; width: 32px; height: 32px;"></canvas></td></tr></tbody></table></div><div class="undefined" style="position: absolute; overflow: hidden; pointer-events: auto; user-select: none; cursor: default; width: 10px; height: 4px; left: 774px; top: 18px;"></div><div class="tpFullScreen" style="position: absolute; overflow: visible; pointer-events: auto; user-select: none; cursor: pointer; width: 32px; height: 32px; display: block; left: 784px; top: 4px;"><canvas width="32" height="32" class="ButtonSkin" style="display: block; width: 32px; height: 32px; position: absolute; left: 0px; top: 0px;"></canvas><table cellspacing="0" cellpadding="0" style="position: relative; left: 0px; top: 0px; margin-right: auto; margin-left: auto; height: 32px;"><tbody><tr><td align="center" style="vertical-align: middle;"><canvas width="32" height="32" class="IconFullscreen" style="display: block; width: 32px; height: 32px;"></canvas></td></tr></tbody></table></div></div></div></div><div style="position: absolute; overflow: hidden; left: 0px; top: 0px; width: 836px; height: 419px;"><div class="LinkedContainer" style="position: absolute; overflow: hidden; pointer-events: none; top: 0px; left: 0px; bottom: 0px; right: 0px; width: 836px; height: 419px;"><div class="tpRegion" style="position: absolute; overflow: hidden; height: 419px; pointer-events: inherit; user-select: none; cursor: default; z-index: 1; opacity: 0; width: 0px; left: 836px; top: 0px;"><div class="tpColumn" style="position: absolute; overflow: hidden; height: 0px; pointer-events: auto; user-select: none; cursor: default; left: 0px; top: 209px; width: 0px;"><div class="tpShare" aria-hidden="true" style="position: absolute; overflow: visible; pointer-events: auto; user-select: none; cursor: pointer; display: none; height: 50px; width: 50px; left: 0px; top: -235px;"></div></div></div><div style="position: absolute; overflow: hidden; left: 0px; top: 0px; width: 836px; height: 419px;"></div></div></div></div></div></div></div><div style="position: relative; overflow: hidden; left: 1px; width: 836px; height: 471px;"></div></div></div></div></div>
</div>

<script>
    // Add Headers
    if (!SDKHelper.isResourceLoaded('mpx_headers')) {
        sdk_logger_info('MPX Headers loaded');
        SDKHelper.resourceLoaded('mpx_headers');
        jQuery('head').append('<meta name="tp:EnableExternalController" content="true" />');
        jQuery('head').append('<meta name="tp:PreferredRuntimes" content="universal" />');
        jQuery('head').append('<meta name="tp:PreferredFormats" content="M3U, MPEG4" />');
        jQuery('head').append('<meta name="tp:initialize" content="false" />');

    } else {
        sdk_logger_info('MPX Headers already loaded');
    }

    function sdk_prepare_player_1() {
        sdk_logger_info('Preparing Player');
        player_1 = new Player('player-1');

                player_1.releaseUrl = "https://link.theplatform.eu/s/XRRASC/PtQBdUBprxzo?policy=24218898&lang=es&mbr=true&format=smil&manifest=m3u&switch=ngces";
                player_1.scopes = "scope_1";
        player_1.allowFullScreen = "true";
        player_1.skinUrl = "https://players.fichub.com/resources/mpx/skins/flat/flat.min.json?20190404123821";
        player_1.showNav = "false";
        player_1.allowRss = "false";
        player_1.layoutUrl = "//players.fichub.com/api/v1/get-layout?layout=global_sites&country=ES";
        player_1.autoPlay = "1";
        player_1.allowLink = "false";
        player_1.showFullTime = "true";
        player_1.showTitle = "false";
        player_1.playerUrl = "https://players.fichub.com/resources/iframe/iframe.html?data=dGVtcGxhdGU9bmdwZ3MtaWZyYW1lJTJGZGVmYXVsdCZjb3VudHJ5PUVTJnNpdGVfc2VjdGlvbl9pZD13d3cubmF0aW9uYWxnZW9ncmFwaGljLmVzJmF1dG9wbGF5PWZhbHNlJmlkPUxpZ2h0UG9sbHV0aW9uMTAxRVMxJnZpZGVvX2NhdGVnb3J5PU1lZGlvJTIwQW1iaWVudGUmY2hhbm5lbD0mcGdfcmF0aW5nPSZzaG93VGl0bGU9JnZpZGVvX3B1YmxpY2F0aW9uRGF0ZT0wMiUyRjA0JTJGMjAxOSZpbnN0YW5jZV9pZD0xJnBsYXllclVybD1odHRwcyUzQSUyRiUyRnd3dy5uYXRpb25hbGdlb2dyYXBoaWMuZXMlMkZtZWRpby1hbWJpZW50ZSUyRmRhdG9zLWRlbC1kaWEtZGUtbGEtdGllcnJhLXBvci1xdWUtc2UtY2VsZWJyYS1kb25kZS1lbXBlem8meWIuZGV2aWNlX29zPVdpbmRvd3MmbG9jYXRpb249aHR0cHMlM0ElMkYlMkZ3d3cubmF0aW9uYWxnZW9ncmFwaGljLmVzJTJGbWVkaW8tYW1iaWVudGUlMkZkYXRvcy1kZWwtZGlhLWRlLWxhLXRpZXJyYS1wb3ItcXVlLXNlLWNlbGVicmEtZG9uZGUtZW1wZXpvJmdhX3RpdGxlPURhdG9zJTIwZGVsJTIwRCVDMyVBRGElMjBkZSUyMGxhJTIwVGllcnJhJTNBJTIwJUMyJUJGUG9yJTIwcXUlQzMlQTklMjBzZSUyMGNlbGVicmElM0YlMjAlQzIlQkZEJUMzJUIzbmRlJTIwZW1wZXolQzMlQjMlM0YlMjAlN0MlMjBOYXRpb25hbCUyMEdlb2dyYXBoaWM=&amp;b=20190404123821";
        player_1.allowEmbed = "false";

        player_1.controlBackgroundColor = "0x000000";
        player_1.backgroundColor = "0x000000";
        player_1.controlFrameColor = "0x000000";
        player_1.frameColor = "0x626262";
        player_1.textBackgroundColor = "0x000000";
        player_1.controlHighlightColor = "0x000000";
        player_1.controlHoverColor = "0xffffff";
        player_1.loadProgressColor = "0x393839";
        player_1.controlSelectedColor = "0x000000";
        player_1.playProgressColor = "0xd8d8d8";

        player_1.scrubberFrameColor = "0xd8d8d8";
        player_1.controlColor = "0xd8d8d8";
        player_1.textColor = "0xd8d8d8";
        player_1.scrubberColor = "0xd8d8d8";
        player_1.scrubTrackColor = "0x000000";
        player_1.pageBackgroundColor = "0x000000";

                player_1.endCard="none";
        
        if (window.location.protocol == 'http:') {
            var fwAdManagerSwfUrl = 'http%3A%2F%2Fmssl.fwmrm.net%2Flibs%2Fadm%2F6.24.0%2FAdManager.%7Bext%7D';
            var fwAdManagerJsUrl = 'http%3A%2F%2Fmssl.fwmrm.net%2Flibs%2Fadm%2F6.24.0%2FAdManager.%7Bext%7D';
        } else {
            var fwAdManagerSwfUrl = 'https%3A%2F%2Fmssl.fwmrm.net%2Flibs%2Fadm%2F6.24.0%2FAdManager.%7Bext%7D';
            var fwAdManagerJsUrl = 'https%3A%2F%2Fmssl.fwmrm.net%2Flibs%2Fadm%2F6.24.0%2FAdManager.%7Bext%7D';
        }

        var site_section_id_1 = 'www.nationalgeographic.es';
        var browser = '';
        var fw_device = 'desktop';
        try {
            browser = SDKHelper.getBrowserData();
            fw_device = browser.device.toLowerCase();
        } catch (e) {}

        var fw_site_section_matrix = {"FR":{"mobile":"mweb.nationalgeographic.fr","tablet":"mtab.nationalgeographic.fr","pc":"www.nationalgeographic.fr"},"DE":{"mobile":"mweb.nationalgeographic.de","tablet":"mtab.nationalgeographic.de","pc":"www.nationalgeographic.de"},"NL":{"mobile":"mweb.nationalgeographic.nl","tablet":"mtab.nationalgeographic.nl","pc":"www.nationalgeographic.nl"},"PT":{"mobile":"mweb.nationalgeographic.pt","tablet":"mtab.nationalgeographic.pt","pc":"www.nationalgeographic.pt"},"ES":{"mobile":"mweb.nationalgeographic.es","tablet":"mtab.nationalgeographic.es","pc":"www.nationalgeographic.es"},"BR":{"mobile":"mweb.nationalgeographicbrasil.br","tablet":"mtab.nationalgeographicbrasil.br","pc":"www.nationalgeographicbrasil.br"},"UK":{"mobile":"mweb.nationalgeographic.uk","tablet":"mtab.nationalgeographic.uk","pc":"www.nationalgeographic.uk"},"IT":{"mobile":"mweb.nationalgeographic.it","tablet":"mtab.nationalgeographic.it","pc":"www.nationalgeographic.it"},"PL":{"mobile":"mweb.nationalgeographic.pl","tablet":"mtab.nationalgeographic.pl","pc":"www.nationalgeographic.pl"},"TR":{"mobile":"mweb.nationalgeographic.tr","tablet":"mtab.nationalgeographic.tr","pc":"www.nationalgeographic.tr"},"MX":{"mobile":"mweb.nationalgeographic.mx","tablet":"mtab.nationalgeographic.mx","pc":"www.nationalgeographic.mx"}};

        if (fw_site_section_matrix['ES'] && fw_site_section_matrix['ES'][fw_device]) {
            if (window.location.pathname == '/') {
                site_section_id_1 = fw_site_section_matrix['ES'][fw_device] + '/home_page';
            } else {
                site_section_id_1 = fw_site_section_matrix['ES'][fw_device] + '/video';
            }

            if (jQuery('meta[name="englishPrimaryTerm"]').length > 0) {
                site_section_id_1 = fw_site_section_matrix['ES'][fw_device] + '/' + jQuery('meta[name="englishPrimaryTerm"]').first().attr('content');
            }
        }

        var player_width = $('#player-1').width();
        var player_height = $('#player-1').height();

        var keyValues = '|keyValues=_fw_player_width%3D' + player_width + '%26_fw_player_height%3D' + player_height;

        
        console.log('---- SDK FREEWHEEL - SITE SECTION ID: ' + site_section_id_1);

        player_1.pluginFWSwf = "type=adcomponent|url=//pdk.theplatform.eu/pdk/swf/freewheel.swf|siteSectionId=" + site_section_id_1 + "|pemURLsSeparator=%2C|requestTimeout=5|customVideoAssetIdField=externalAdvertiserId|priority=1|networkId=393756|adManagerUrl=%fwAdManagerUrl%" + keyValues + "|serverUrl=https%3A%2F%2F6021c.v.fwmrm.net%2F|playerProfile=393756%3Anatgeo_intl_cts_%7Bruntime%7D_live|tpos=0|tpcl=PREROLL|ptgt=a|flag=+exvt|pvrn=" + SDKHelper.hashCode(site_section_id_1) + "|pvrn=" + SDKHelper.hashCode('LightPollution101ES1');
        player_1.pluginFWJs = "type=adcomponent|url=//pdk.theplatform.eu/pdk/js/plugins/freewheel.js|siteSectionId=" + site_section_id_1 + "|pemURLsSeparator=%2C|requestTimeout=5|customVideoAssetIdField=externalAdvertiserId|priority=1|networkId=393756|adManagerUrl=%fwAdManagerUrl%" + keyValues + "|serverUrl=https%3A%2F%2F6021c.v.fwmrm.net%2F|playerProfile=393756%3Anatgeo_intl_cts_%7Bruntime%7D_live|tpos=0|tpcl=PREROLL|ptgt=a|flag=+exvt|pvrn=" + SDKHelper.hashCode(site_section_id_1) + "|pvrn=" + SDKHelper.hashCode('LightPollution101ES1');

        player_1.pluginFWSwf = player_1.pluginFWSwf.replace('http%3A', encodeURIComponent(window.location.protocol)).replace('%fwAdManagerUrl%', fwAdManagerSwfUrl);
        player_1.pluginFWJs = player_1.pluginFWJs.replace('http%3A', encodeURIComponent(window.location.protocol)).replace('%fwAdManagerUrl%', fwAdManagerJsUrl);


        
        
        // Load youbora plugin
        player_1.pluginYoubora = "type=tracking|url=//smartplugin.youbora.com/v5/javascript/theplatform/5.4.6/sp.min.js";

                var tpPlayerWarning = 0;
        var tpPlayerInitialized_1 = false;
        var _timer_tpPlayer_1 = setInterval(function() {
            if (typeof tpPlayer != 'undefined') {
                clearInterval(_timer_tpPlayer_1);
                sdk_start_player_1();
            } else {
                if (!tpPlayerInitialized_1) {
                    tpPlayerInitialized_1 = true;
                    $pdk.initialize();
                    sdk_logger_info('tpPlayer is not defined, call $pdk.initialize() one time');
                }

                tpPlayerWarning++;
                console.warn('tpPlayer is not defined');
                if (tpPlayerWarning == 1) {
                    sdk_logger_warn('tpPlayer is not defined');
                }
            }
        }, 250);
        
        //Fix to load the 5.4.x versions for youbora
        var _timer_youbora_1 = setInterval(function() {
            if (typeof $YB != 'undefined' && typeof SDKYoubora != 'undefined') {
                clearInterval(_timer_youbora_1);
                youbora_plugin_1 = new SDKYoubora('1', {
    'error_api': {
        'url': 'https://nqs.nice264.com',
        'plugin': '5.4.6'
    },

    'accountCode': 'foxic',

    'media': {
        'referenceId': 'LightPollution101ES1',
        'title': 'Contaminación lumínica 101',
        'duration': '164',
        'cdn': 'AKAMAI'
    },

    'properties': {
        'content_id': '313361477193',
        'filename': 'http://data.media.theplatform.eu/media/data/Media/313361477193',

        'content_metadata' : {
            'title': 'Contaminación lumínica 101',
            'show': '',
            'duration': '164',
            'episode': '',
            'season': '',
            'genre': '',
            'language': 'ES',
            'year': '',
            'cast': '',
            'director': '',
            'pg_rating': '',
            'channel': ''
        },

        'content_type': 'VOD',

        'device': {
            'manufacturer': 'Windows',
            'type': 'Web',
            'year': '',
            'firmware': ''
        }
    },

    'extraParams': {
        'param1': '',
        'param2': 'NG_GS_ES',
        'param3': '',
        'param4': ''
    }
}).bind();
sdk_logger_info('Youbora plugin loaded');

// Check for invalid release url
jQuery.ajax({
    url: player_1.releaseUrl,
    type: 'GET',
    async: false,
    success: function(response) {
        if (player_1.releaseUrl.indexOf('//') != 0 && player_1.releaseUrl.indexOf('http') != 0) {
            if (typeof youbora_plugin_1 != 'undefined') {
                youbora_plugin_1.notifyError(SDKYouboraPlugin.errors.invalidReleaseUrl);
            }
        }
    },
    error: function(response) {
        if (typeof youbora_plugin_1 != 'undefined') {
            youbora_plugin_1.notifyError(SDKYouboraPlugin.errors.invalidReleaseUrl);
        }
    }
});


            }
        }, 250);

        
        // Check Share Video Plugin
                
if (SDKHelper.isChromeOrSafari()) {
    //LOAD CSS
    jQuery('head').append(jQuery('<link>').attr({
        type: 'text/css',
        rel: 'stylesheet',
        href: 'https\u003A\/\/players.fichub.com\/plugins\/mpx\/share_video\/ngpgs\u002Diframe\/css\/share_video_svg.css\u003F20190404123821'
    }));
} else {
    //LOAD CSS
    jQuery('head').append(jQuery('<link>').attr({
        type: 'text/css',
        rel: 'stylesheet',
        href: 'https\u003A\/\/players.fichub.com\/plugins\/mpx\/share_video\/ngpgs\u002Diframe\/css\/share_video.css\u003F20190404123821'
    }));
}


/**
 *
 * @constructor
 */
function ShareVideo() {
    var locked_1 = false;

    var PLUGIN_ID = 'shareVideoCard';
    var PLUGIN_LAYER = 'overlays';

    var currentLayoutUrl = player_1.layoutUrl;
    var newLayoutUrl = currentLayoutUrl + '&layout=share_video_default';

    var scaled = false;

    this.config = function () {

        this.data = SDKData.getData('1');

        this.window_location = window.location;

        if (this.data.template.indexOf('ngpgs-iframe') > -1) {
            this.window_location = this.data.location;
        }

        this.urlHomepage = '//players.fichub.com';
        this.urlTitle = '';

                                this.urlHomepage = 'http\u003A\/\/www.nationalgeographic.com.es\/videos';
            
            this.urlTitle = '';
        
                this.iframeSrcDomain = '\/\/players.fichub.com\/resources\/iframe\/1.0.html\u003Fdata\u003D';
        
        if (location.protocol == 'https:') {
            this.iframeSrcDomain = 'https:' + this.iframeSrcDomain;
        } else {
            this.iframeSrcDomain = 'http:' + this.iframeSrcDomain;
        }

                this.titleTag = 'Videos';
                var browser = SDKHelper.getBrowserData();
        var device = browser.device.toLowerCase();

        if (device == 'pc') {
            device = 'www';
        }

        //this.iframeSrcData = SDKData.getEncodedDataSV('1', device);

        var finalData = '';
        var encodedData = '';

        //Check template
        if (this.data.template.indexOf('ngpgs-iframe') > -1 || (this.data.template.indexOf('sire') > -1 && this.data.clip != undefined) ) {
            finalData = JSON.parse(JSON.stringify(this.data));
        } else {
            finalData = jQuery.extend(this.data, SDKParameterBag.bags['1']);
        }

        finalData['site_section_id'] = device + '.' + finalData['country'].toLowerCase() + '.embedded';
        delete finalData['yb'];

        encodedData = Base64.encode($.param(castToDotAnnotation(finalData)));

        this.iframeSrcUrl = this.iframeSrcDomain + encodedData;

        var videoTitle = "";

                    videoTitle = 'Contaminaci\u00F3n\u0020lum\u00EDnica\u0020101';
        


        this.contentToShare = videoTitle + ' ' + this.window_location;
        this.contentToShareTwitter = this.contentToShare;

                this.contentToShareTwitter = this.contentToShareTwitter + ' via ' + '\u0040natgeoespana';
            }

    this.init = function() {

        this.config();

        // Create the customCards object
        var customCards = { };

        if (SDKHelper.isMobile()) {
            customCards.markup = "" + this.getMobileDiv()
        } else {
            customCards.markup = "" + this.getDiv();
        }

        // Create the presenter object
        customCards.MiniScrubberPresenter = function () { }

        // Create the presenter object
        customCards.MiniScrubberPresenter = function () { }

        // Implement the card presenter show method
        customCards.MiniScrubberPresenter.prototype.show = function (state) {

            // Listener for right media social
            var panelShare = $('#panel_share_1');
            var closeIcon = $('#close_icon_1');

            var facebookIcon = $('#facebook_icon_1');
            var twitterIcon = $('#twitter_icon_1');
            var embedIcon = $('#embed_icon_1');

            var facebookIconPanel = $('#facebook_icon_panel_1');
            var twitterIconPanel = $('#twitter_icon_panel_1');

            var copyButton = $('#copy_button_1');

            // Retrieve the controller from state
            var me = this;
            this.controller = state.controller;

            // Append the card and styles to the page
            $pdk.jQuery(document.head).append(customCards.styles);
            this.card = state.card;
            this.state= state;

            // Display the mini scrubber card
            $pdk.jQuery(this.card).css('display', 'none');
            $pdk.jQuery(this.card).fadeIn(500);

            // Attach an event listener to the OnShowControls event to handle what happens when the playback controls appear
            this.controller.addEventListener("OnShowControls", function (e) { me.showControls(e); });

            if (SDKHelper.isMobile()) {
                var whatsappIcon = $('#whatsapp_icon_1');
                var whatsappIconPanel = $('#whatsapp_icon_panel_1');
                whatsappIcon.click(function() {
                    sdk_player_method_pause_1();
                    pause();
                });

                whatsappIconPanel.click(function() {
                    sdk_player_method_pause_1();
                    pause();
                });
            }

            facebookIcon.click(function() {
                sdk_player_method_pause_1();
                pause();
            });

            twitterIcon.click(function() {
                sdk_player_method_pause_1();
                pause();
            });

            facebookIconPanel.click(function() {
                sdk_player_method_pause_1();
                pause();
            });

            twitterIconPanel.click(function() {
                sdk_player_method_pause_1();
                pause();
            });

            embedIcon.click(function() {
                panelShare.css('display', 'inline');
                $pdk.controller.hidePlayerCard("forms", "relatedVideosCard1", ['scope_1']);
                sdk_player_method_pause_1();
                pause();
            });

            closeIcon.click(function() {
                panelShare.css('display', 'none');
                sdk_player_method_unpause_1();
                unpause();

                var evt = document.createEvent("Event");
                evt.initEvent("plugins_communication",true,true);
                evt.payload = {};
                evt.payload.plugin = PLUGIN_ID;
                evt.payload.action = "hide";
                document.dispatchEvent(evt);
            });

            copyButton.click(function () {

                var elementId = 'embed_code_1';

                var input = document.getElementById(elementId);
                var isiOSDevice = navigator.userAgent.match(/ipad|iphone/i);

                if (isiOSDevice) {

                    var editable = input.contentEditable;
                    var readOnly = input.readOnly;

                    input.contentEditable = true;
                    input.readOnly = false;

                    var range = document.createRange();
                    range.selectNodeContents(input);

                    var selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);

                    input.setSelectionRange(0, 999999);
                    input.contentEditable = editable;
                    input.readOnly = readOnly;

                } else {
                    input.select();
                }

                document.execCommand('copy');
            });
        }

        // Implement the card presenter hide method
        customCards.MiniScrubberPresenter.prototype.hide = function () { }

        // Handle the OnShowControls event - hide the mini scrubber when the end user hovers over the media area.
        customCards.MiniScrubberPresenter.prototype.showControls = function (e) {

            var me = this;

            if (e.data.regionId.indexOf("Bottom") >= 0 && locked_1 != true) {

                if (!e.data.visible) {
                    $pdk.jQuery(this.card).find("ul").hide();  //hide the card (i.e., the mini scrubber) if the controls are not visible
                }
                else {
                    $pdk.jQuery(this.card).find("ul").fadeIn(500);  //display (fading in) the card if the controls are visible
                }
            }
        }

        $pdk.controller.addPlayerCard(PLUGIN_LAYER, PLUGIN_ID, customCards.markup, "urn:theplatform:pdk:area:player", {}, customCards.MiniScrubberPresenter, 1, ['scope_1']);
    }

    this.show = function() {
        sdk_logger_info('share_video show');
        $pdk.controller.showPlayerCard(PLUGIN_LAYER, PLUGIN_ID, null, null, ['scope_1']);
    }

    this.hide = function() {
        sdk_logger_info('share_video hide');
        $pdk.controller.hidePlayerCard(PLUGIN_LAYER, PLUGIN_ID, ['scope_1']);
    }

    this.getMobileDiv = function () {
        sdk_logger_info('share_video getDiv');
        return '<div id="'+PLUGIN_ID+'" class="tpPlayerCard '+PLUGIN_ID+'">' +
                    '<div id="panel_share_1" class="panel_share">' +
                        '<div class="share_close">' +
                            '<img id="close_icon_1" class="close_icon" src="https\u003A\/\/players.fichub.com\/plugins\/mpx\/share_video\/img\/close_icon_white.svg\u003F20190404123821" />' +
                        '</div>' +

                        '<div class="embed_video">' +
                            '<h5>COMPARTIR</h5>' +
                            '<ul class="social_media">' +
                                '<li class="icon">' +
                                    '<a class="fb-xfbml-parse-ignore" target="_blank" onclick="return !window.open(this.href, \'\', \'width=500,height=500\')" href="https://www.facebook.com/sharer/sharer.php?u='+ this.window_location +'"><img src="https\u003A\/\/players.fichub.com\/plugins\/mpx\/share_video\/img\/facebook_icon_white.svg\u003F20190404123821" id="facebook_icon_panel_1" class="facebook_icon_panel facebook socialIcon fb-share-button" /></a>' +
                                '</li>' +
                                '<li class="icon_tw">' +
                                    '<a class="fb-xfbml-parse-ignore" target="_blank" onclick="return !window.open(this.href, \'\', \'width=500,height=500\')" href="https://twitter.com/intent/tweet?text='+ this.contentToShareTwitter +'"><img src="https\u003A\/\/players.fichub.com\/plugins\/mpx\/share_video\/img\/twitter_icon_white.svg\u003F20190404123821" id="twitter_icon_panel_1" class="twitter_icon_panel twitter socialIcon"/></a>' +
                                '</li>' +
                                '<li class="icon_wha">' +
                                    '<a class="fb-xfbml-parse-ignore" target="_blank" href="whatsapp://send?text='+ this.contentToShare +'"><img src="https\u003A\/\/players.fichub.com\/plugins\/mpx\/share_video\/img\/whatsapp_icon_white.svg\u003F20190404123821" id="whatsapp_icon_panel_1" class="whatsapp_icon_panel whatsapp socialIcon" /></a>' +
                                '</li>' +
                            '</ul>' +
                        '</div>' +

                        '<h6>INSERTAR\u0020VIDEO</h6>' +
                        '<form>' +
                            '<input id="embed_code_1" type="text" value="'+this.getEmbedCode()+'" readonly>' +
                        '</form>' +

                        '<div class="button" id="copy_button_1">' +
                            'COPIAR' +
                        '</div>' +

                    '</div>' +
                '</div>';
    }

    this.getDiv = function () {
        sdk_logger_info('share_video getDiv');
            return '<div id="'+PLUGIN_ID+'" class="tpPlayerCard '+PLUGIN_ID+'">' +
                    '<ul class="social_media_right">' +
                        '<li class="icon">' +
                                '<a class="fb-xfbml-parse-ignore" target="_blank" onclick="return !window.open(this.href, \'\', \'width=500,height=500\')" href="https://www.facebook.com/sharer/sharer.php?u='+ this.window_location +'"><img id="facebook_icon_1" class="facebook_icon facebook socialIcon fb-share-button" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" /></a>' +
                        '</li>' +
                        '<li class="icon_tw">' +
                            '<a class="fb-xfbml-parse-ignore" target="_blank" onclick="return !window.open(this.href, \'\', \'width=500,height=500\')" href="https://twitter.com/intent/tweet?text='+ this.contentToShareTwitter +'"><img id="twitter_icon_1" class="twitter_icon twitter socialIcon" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" /></a>' +
                        '</li>' +
                        '<li class="icon_em">' +
                        '<img id="embed_icon_1" class="embed_icon embed socialIcon" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" />' +
                        '</li>' +
                    '</ul>' +
                    '<div id="panel_share_1" class="panel_share">' +
                        '<div class="share_close">' +
                            '<img id="close_icon_1" class="close_icon" src="https\u003A\/\/players.fichub.com\/plugins\/mpx\/share_video\/img\/close_icon_white.svg\u003F20190404123821" />' +
                        '</div>' +

                        '<div class="embed_video">' +
                            '<h5>COMPARTIR</h5>' +
                            '<ul class="social_media">' +
                                '<li class="icon">' +
                                    '<a class="fb-xfbml-parse-ignore" target="_blank" onclick="return !window.open(this.href, \'\', \'width=500,height=500\')" href="https://www.facebook.com/sharer/sharer.php?u='+ this.window_location +'"><img src="https\u003A\/\/players.fichub.com\/plugins\/mpx\/share_video\/img\/facebook_icon_white.svg\u003F20190404123821" id="facebook_icon_panel_1" class="facebook_icon_panel facebook socialIcon fb-share-button" /></a>' +
                                '</li>' +
                                '<li class="icon_tw">' +
                                    '<a class="fb-xfbml-parse-ignore" target="_blank" onclick="return !window.open(this.href, \'\', \'width=500,height=500\')" href="https://twitter.com/intent/tweet?text='+ this.contentToShareTwitter +'"><img src="https\u003A\/\/players.fichub.com\/plugins\/mpx\/share_video\/img\/twitter_icon_white.svg\u003F20190404123821" id="twitter_icon_panel_1" class="twitter_icon_panel twitter socialIcon"/></a>' +
                                '</li>' +
                            '</ul>' +
                        '</div>' +

                        '<h6>INSERTAR\u0020VIDEO</h6>' +
                        '<form>' +
                            '<input id="embed_code_1" type="text" value="'+this.getEmbedCode()+'" readonly>' +
                        '</form>' +

                        '<div class="button" id="copy_button_1">' +
                            'COPIAR' +
                        '</div>' +
                    '</div>' +
            '</div>';
    }

    this.getEmbedCode = function () {
        return "<div style='display: block; position: relative; height: 100%;'>" +
            "<div>" +
            "<iframe src='"+this.iframeSrcUrl+"' allowfullscreen webkitallowfullscreen mozallowfullscreen style='width: 100%; height: 100%; position: absolute; top: 0px; bottom: 0px; right: 0px; left: 0px;'> </iframe>" +
            "</div>" +
            "</div>" +
            "<div style='display:none'>" +
            "<a href='"+this.urlHomepage+"'>"+this.urlTitle+"</a>" +
            "</div>";
    }

    $pdk.controller.addEventListener('OnMediaStart', function(payload) {
        SDKHelper.triggerEvent(1, 'start', payload);
        if (!payload.data.baseClip.isAd) {
            start();
        }
    }, ['scope_1']);

    $pdk.controller.addEventListener('OnMediaPause', function(payload) {
        SDKHelper.triggerEvent(1, 'pause', payload);
        pause();
    }, ['scope_1']);

    $pdk.controller.addEventListener('OnMediaUnpause', function(payload) {
        SDKHelper.triggerEvent(1, 'unpause', payload);
        unpause();
    }, ['scope_1']);

    $pdk.controller.addEventListener('OnShowControls', function(payload) {
        SDKHelper.triggerEvent(1, 'OnShowControls', payload);

        if (!scaled) {
            scale();
            scaled = true;
        }
    }, ['scope_1']);

    function castToDotAnnotation(obj) {
        var res = {};
        (function recurse(obj, current) {
            for(var key in obj) {
                var value = obj[key];
                var newKey = (current ? current + "." + key : key);  // joined key with dot
                if(value && typeof value === "object") {
                    recurse(value, newKey);  // it's a nested object, so do it again
                } else {
                    res[newKey] = value;  // it's not an object, so set the property
                }
            }
        })(obj);

        return res;
    }

    function pause() {
        locked_1 = true;
        $pdk.controller.setPlayerLayoutUrl(newLayoutUrl, ['scope_1']);
    }

    function start () {
        locked_1 = false;
        $pdk.controller.setPlayerLayoutUrl(currentLayoutUrl, ['scope_1']);
    }

    function unpause () {
        locked_1 = false;
        $pdk.controller.setPlayerLayoutUrl(currentLayoutUrl, ['scope_1']);
    }

    function scale () {
        var width = $('#'+PLUGIN_ID).width();

        var normalScale = 1.0;
        var inputScale = 1.0;

        if (500 <= width && width < 600) {
            normalScale = 0.8;
            inputScale = 0.9;
        } else if (400 <= width && width < 500) {
            normalScale = 0.7;
            inputScale = 0.8;
        } else if (300 <= width && width < 400) {
            normalScale = 0.6;
            inputScale = 0.7;
        } else if (200 <= width && width < 300) {
            normalScale = 0.5;
            inputScale = 0.6;
        } else if (100 <= width && width < 200) {
            normalScale = 0.4;
            inputScale = 0.5;
        } else if (width < 100) {
            normalScale = 0.3;
            inputScale = 0.4;
        }

        if (width < 500) {
            //Upload lateral menu
            $('.social_media_right').css('top', '30%');
        }

        // Firefox
        if (typeof document.body.style.zoom == "undefined") {
            $('#panel_share_1').css('transform', 'scale('+normalScale+')');
            $('.social_media_right').css('transform', 'scale('+normalScale+')');
            $('#embed_code_1').css('transform', 'scale('+inputScale+')');
            $('.social_media_right').css('transform-origin', 'right');
            $('#panel_share_1').css('transform-origin', 'bottom');
            $('#embed_code_1').css('transform-origin', 'left');
        } else {
            $('#'+PLUGIN_ID).css('zoom', normalScale);
        }
    }

    function copyToClipboard(el) {

        // handle iOS as a special case
        if (navigator.userAgent.match(/ipad|ipod|iphone/i)) {

            // save current contentEditable/readOnly status
            var editable = el.contentEditable;
            var readOnly = el.readOnly;

            // convert to editable with readonly to stop iOS keyboard opening
            el.contentEditable = true;
            el.readOnly = true;

            // create a selectable range
            var range = document.createRange();
            range.selectNodeContents(el);

            // select the range
            var selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            el.setSelectionRange(0, 999999);

            // restore contentEditable/readOnly to original state
            el.contentEditable = editable;
            el.readOnly = readOnly;
        }
        else {
            el.select();
        }

        // execute copy command
        document.execCommand('copy');
    }

}

var shareVideo = new ShareVideo();
shareVideo.init();
shareVideo.show();


            }

    function sdk_start_player_1() {
        sdk_logger_info('Starting Player');

        // Bind Tracking
        player_1.bind();

        // Subtitles Plugin
        new SDKSubtitles(['scope_1'], ["es"], 'Selecciona tu idioma', 'Sin subtítulos').load('https://players.fichub.com/plugins/mpx/subtitles/subtitles_v2.html?20190404123821');

                // Unmute Plugin
        if (1){
            new Unmute(['scope_1'], 'https://players.fichub.com/').load();
        }
        
        //Related Videos Plugin and Continue Watching Plugin
                    var translations = [];
            translations['related_videos.next'] = 'Siguiente';
            translations['related_videos.now'] = 'Viendo ahora';
            translations['continuous_videos.sec'] = 'segundos_segundo';
            translations['continuous_videos.just_watched'] = 'Visto recientemente';
            translations['continuous_videos.up_next'] = 'Siguientes';
            translations['continuous_videos.remaining_time'] = 'El video comenzará en';
            translations['continuous_videos.sec_2'] = '';
            new RelatedVideos(['scope_1'], 'ngpgs-iframe', '1', JSON.parse(JSON.stringify([{"video_title":"Contaminaci\u00f3n lum\u00ednica 101","thumb_url":"https:\/\/sire-ngcbg-thumbs.fichub.com\/NGP_NatGeo_GS\/861\/812\/Light_Pollution_101_ES~~~~~es~mux~~1.jpg","url":"","hash":""}])), player_1.layoutUrl, 'https://players.fichub.com/', '', 'ES', '1', '1', translations);
        
        // Add playsinline attribute to the player
        $pdk.controller.addEventListener("OnLoadReleaseUrl", function(payload) {
            console.log('SDK - Trigger playsinline to player via OnLoadReleaseUrl');
            jQuery('.tpVideo video').attr('playsinline', '');
        }, ['scope_1']);

        $pdk.controller.addEventListener("OnSetReleaseUrl", function(payload) {
            console.log('SDK - Trigger playsinline to player via OnSetReleaseUrl');
            jQuery('.tpVideo video').attr('playsinline', '');
        }, ['scope_1']);

        // Call Player Callbacks
        $pdk.controller.addEventListener('OnMediaStart', function(payload) {
            // Hack for FreeWheel Style problems
            setTimeout(function() {
                if (payload.data.baseClip.isAd) {
                    jQuery('#player-1 #fw-pdk-plugin-video-display-base').css('z-index', 10000);
                    jQuery('#player-1 #fw-pdk-plugin-video-display-base').css('cursor', 'pointer');
                    jQuery('#player-1 #fw-pdk-plugin-video-display-base').css('height', jQuery('#player-1').outerHeight() + 'px');
                    jQuery('#player-1 #fw-pdk-plugin-video-display-base').show();
                } else {
                    jQuery('#player-1 #fw-pdk-plugin-video-display-base').hide();
                }
            }, 250);

            SDKHelper.triggerEvent(1, 'start', payload);
        }, ['scope_1']);

        $pdk.controller.addEventListener('OnMediaComplete', function(payload) {
            SDKHelper.triggerEvent(1, 'complete', payload);
        }, ['scope_1']);

        $pdk.controller.addEventListener('OnMediaEnd', function(payload) {
            SDKHelper.triggerEvent(1, 'end', payload);
        }, ['scope_1']);

        $pdk.controller.addEventListener('OnMediaUnpause', function(payload) {
            SDKHelper.triggerEvent(1, 'unpause', payload);
        }, ['scope_1']);

        $pdk.controller.addEventListener('OnMediaPause', function(payload) {
            if (payload.data.userInitiated) {
                SDKHelper.triggerEvent(1, 'pause', payload);
            }
        }, ['scope_1']);

        $pdk.controller.addEventListener('OnPlayButtonClicked', function (payload) {
            SDKHelper.triggerEvent(1, 'play_button', payload);
        }, ['scope_1']);

        $pdk.controller.addEventListener('OnReleaseEnd', function (payload) {
            SDKHelper.triggerEvent(1, 'release_end', payload);
        }, ['scope_1']);

        $pdk.controller.addEventListener('OnReleaseError', function (payload) {
            if (typeof youbora_plugin_1 != 'undefined') {
                switch (payload.data.exception) {
                    case 'GeoLocationBlocked':
                        youbora_plugin_1.notifyError(SDKYouboraPlugin.errors.geoLocationBlocked);
                        break;
                    case 'NotYetAvailable':
                        youbora_plugin_1.notifyError(SDKYouboraPlugin.errors.notYetAvailable);
                        break;
                    case 'Expired':
                        youbora_plugin_1.notifyError(SDKYouboraPlugin.errors.Expired);
                        break;
                    default:
                        youbora_plugin_1.notifyError(SDKYouboraPlugin.errors.genericError);
                        break;
                }
            }
            SDKHelper.triggerEvent(1, 'release_error', payload);
        }, ['scope_1']);

        $pdk.controller.addEventListener("OnMediaLoadStart", function onPlayerLoaded(e) {
            var adManager = $pdk.plugin.freewheel._instance.adManager, hidden, visibilityChange;

            if (typeof document.hidden !== "undefined") {
                hidden = "hidden";
                visibilityChange = "visibilitychange";
            }
            else if (typeof document.msHidden !== "undefined") {
                hidden = "msHidden";
                visibilityChange = "msvisibilitychange";
            }
            else if (typeof document.webkitHidden !== "undefined") {
                hidden = "webkitHidden";
                visibilityChange = "webkitvisibilitychange";
            }

            //pause only after the user click on the ad
            adManager.addEventListener("defaultClick", function onAdClick(e) {
                document.addEventListener(visibilityChange, function onVisibilitychange() {
                    var isPlay = document[hidden] ? true : false;
                    $pdk.controller.pause(isPlay, ['scope_1'] );
                });
            });
        }, ['scope_1']);

        // temporal tracking code for DE - to be removed!
        
        // Video Plugin Tracking
        var tracking_video_plugin = '';
        if (window.location.hash == '#vprv') {
            tracking_video_plugin = 'vprv';
        } else if (window.location.hash == '#vpcp') {
            tracking_video_plugin = 'vpcp';
        }

        // Bind Tracking
        new SDKMPXTracker('1', ['scope_1'],
            'UA-84641393-1', 'Contaminación lumínica 101', {
                dimension1:  'ES',
                dimension2:  'LightPollution101ES1',
                dimension3:  'NO_CHANNEL',
                dimension4:  'NO_SHOW_TITLE',
                dimension5:  'Contaminación lumínica 101', // Usando plmedia$titleLocalized, esta vacio
                dimension6:  'short',
                dimension7:  'non-auth',
                dimension8:  '02/04/2019',
                dimension9:  '0',
                dimension15: 'Medio Ambiente',
                dimension17: tracking_video_plugin,
                location: SDKData.getData('1').location,
                title: SDKData.getData('1').ga_title
            }).bind();
    }

    // Reverse Callback methods
    function sdk_player_method_play_1() {
        if (player_check_age_verification_1 == true) {
            console.log('SDK PLAYER - Play Method invoked but Age Verification not accepted yet.');
            return;
        }
        if (typeof $pdk == 'undefined') {
            return;
        }
        $pdk.controller.clickPlayButton(['scope_1']);
    }

    function sdk_player_method_pause_1() {
        if (typeof $pdk == 'undefined') {
            return;
        }
        $pdk.controller.pause(true, ['scope_1']);
    }

    function sdk_player_method_unpause_1() {
        if (typeof $pdk == 'undefined') {
            return;
        }
        $pdk.controller.pause(false, ['scope_1']);
    }

    function sdk_player_method_finalize_1() {
        if (typeof $pdk == 'undefined') {
            return;
        }
        $pdk.controller.endCurrentRelease(['scope_1']);
    }

    var step_1 = 0;
    var resources_1 = [];

    // Load PDK
    if (SDKHelper.isResourceLoaded('pdk')) {
        sdk_logger_info('PDK is already loaded');
        sdk_prepare_player_1();
    } else if (SDKHelper.isResourceLoading('pdk')) {
        sdk_logger_info('PDK is loading');
        var _timer_pdk_1 = setInterval(function() {
            if (SDKHelper.isResourceLoaded('pdk')) {
                sdk_logger_info('PDK is has FINALLY loaded');
                clearInterval(_timer_pdk_1);
                sdk_prepare_player_1();
            }
        }, 250);
    } else {
        sdk_logger_info('PDK is not loaded');
        SDKHelper.loadResource('pdk');

        resources_1.push('loadPDK');
        resources_1.push('loadSubtitles');

        if (1) {
            resources_1.push('loadUnmute');
        }

                resources_1.push('loadRelatedVideos');
        
        resources_1.push('sdk_prepare_player_1');

        processResource();
    }

    function loadPDK() {
        jQuery.ajax({
            url: '//pdk-player.fichub.com/5.9.6/web/pdk/tpPdk.js',
            dataType: 'script',
            cache: true,
            success: function() {
                sdk_logger_info('PDK has loaded');
                SDKHelper.resourceLoaded('pdk');
                step_1++;
                processResource();
            },
            error: function (jqXHR) {
                sdk_logger_error('PDK failed to load', { status: jqXHR.status, statusText: jqXHR.statusText });
            }
        });
    }

    function loadSubtitles() {
        jQuery.ajax({
            url: 'https://players.fichub.com/plugins/mpx/subtitles/subtitles.js?20190404123821',
            dataType: 'script',
            cache: true,
            success: function() {
                sdk_logger_info('Subtitles Plugin has loaded');
                step_1++;
                processResource();

            },
            error: function (jqXHR) {
                sdk_logger_error('Subtitles Plugin failed to load', { status: jqXHR.status, statusText: jqXHR.statusText });
                reject('Subtitles Plugin failed to load');
            }
        });
    }

    function loadUnmute() {
        jQuery.ajax({
            url: 'https://players.fichub.com/plugins/mpx/unmute/ngpgs-iframe/index.js?20190404123821',
            dataType: 'script',
            cache: true,
            success: function() {
                sdk_logger_info('Unmute Plugin has loaded');
                step_1++;
                processResource();
            },
            error: function (jqXHR) {
                sdk_logger_error('Unmute Plugin failed to load', { status: jqXHR.status, statusText: jqXHR.statusText });
            }
        });
    }

    function loadRelatedVideos() {
        jQuery.ajax({
            url: 'https://players.fichub.com/plugins/mpx/related_videos/ngpgs-iframe/index.min.js?20190404123821',
            dataType: 'script',
            cache: true,
            success: function() {
                sdk_logger_info('RV Plugin has loaded');
                step_1++;
                processResource();
            },
            error: function (jqXHR) {
                sdk_logger_error('RV Plugin failed to load', { status: jqXHR.status, statusText: jqXHR.statusText });
            }
        });
    }

    function processResource() {
        var resource = resources_1[step_1];

        window[resource]();
    }

    // Load Google Analytics
    if (typeof window['ga'] === 'undefined') {
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject_SDKPlayer_1']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    }

</script>
</div>

<script>

    var options = getOptions();

    var player = new SDK(
        '#player-container',
        options,
        [SDKHelper.setPlayerUrl, SDKHelper.setBrowserData]).init();
</script>

<div style="display: none">
<!-- tpMenuCard -->


<!-- tpRssCard -->


<!-- tpInfoCard -->


<!-- tpErrorCard -->


<!-- tpShareCard -->


<!-- login card-->



<script type="text/javascript">
$pdk.cards = {};

$pdk.cards.presenters = {};

/* Move this into a bundle! */

$pdk.ns("pdk.util");
$pdk.ns("pdk.util.Strings");

$pdk.util.getXMLHttpRequestObject = function()
{
    var ref = null;
    // this is some IE8+ specific XmlHttpRequest object that supports CORS
    if (window.XMLHttpRequest)
    {
        ref = new XMLHttpRequest();
    }
    else if (window.XDomainRequest)
    {
        ref = new XDomainRequest();
    }
    else if (window.ActiveXObject)
    { // Older IE.
        ref = new ActiveXObject("MSXML2.XMLHTTP.3.0");
    }
    return ref;
}

$pdk.util.Strings.doUrlSubstitutions = function(original, vars, start, end)
{

    var url = original;

    if (vars.release && vars.release.title)
    {
        var title = vars.release.title.toLowerCase();
        title = title.replace(/\W+/g, "-");
        url = url.replace(/\{title\}/gi, title);
    }
    else
    {
        url = url.replace(/\{title\}/gi, escape(''));
    }

    if (vars.release && vars.release.url)
    {
        console.log(vars.release.url.split("/")[6]);
        console.log(vars.release.url);
        url = url.replace(/\{releasePid\}/gi, vars.release.url.split("?")[0].split("/")[5]);
    }
    else if (vars.release && vars.release.pid)
    {
        url = url.replace(/\{releasePid\}/gi, vars.release.pid);
    }
    else if (vars.clip)
    {
        url = url.replace(/\{releasePid\}/gi, vars.clip.releasePID);
    }

    if (vars.release&&vars.release.mediaPID)
    {
        url = url.replace(/\{mediaPid\}/gi, vars.release.mediaPID);
    }

    if (vars.clip && vars.clip.baseClip)
    {
        url = url.replace(/\{guid\}/gi, vars.clip.baseClip.guid);
        url = url.replace(/\{id\}/gi, vars.clip.baseClip.contentID);
    }
    if (vars.release)//the release should be the fallback
    {
        if (vars.release.guid)
        {
            url = url.replace(/\{guid\}/gi, vars.release.guid);
        }
        if (vars.release.id)
        {
            url = url.replace(/\{id\}/gi, vars.release.id.substr(vars.release.id.lastIndexOf("/") + 1));
        }
    }

    if (vars.player)
    {
        // if this url has a {playerUrl} token, apply t=start-end on the inner, encoded player Url
        if (url.match(/\{playerUrl\}/i))
        {
            var purl = vars.player.playerurl;
            if (start)
            {
                var delimit = (purl.indexOf("?") >= 0 ? "&" : "?");
                purl += delimit + "t=" + Math.floor(start) + (end ? "-" + Math.floor(end) : "");
            }

            url = url.replace(/\{playerUrl\}/gi, escape($pdk.util.Strings.doUrlSubstitutions(purl.replace(/\{playerUrl\}/gi, ''), vars)));
        }
        // otherwise, this url must be the playerUrl, so append to the main url
        else if (start)
        {
            // if this is actually an HTML blob
            if (url.indexOf("<") == 0 || url.indexOf("&lt;") == 0)
            {
                var regex = /(src=['"])(.*?)(['"])/;
                if (url.match(regex))
                {
                    var delimit = (url.match(regex)[2].indexOf("?") >= 0 ? "&" : "?");
                    url = url.replace(regex, "$1$2" + delimit + "t=" + Math.floor(start) + (end ? "-" + Math.floor(end) : "") + "$3");
                }
            }
            else
            {
                var delimit = (url.indexOf("?") >= 0 ? "&" : "?");
                url += delimit + "t=" + Math.floor(start) + (end ? "-" + Math.floor(end) : "");
            }
        }
    }

    return url;
}

$pdk.cards.presenters.tpMenuCardPresenter = function() {
}

$pdk.cards.presenters.tpMenuCardPresenter.prototype.centerTiles = function()
{
    var regionHeight = $pdk.jQuery(this.card).find(".tpRelatedItems").outerHeight() - $pdk.jQuery(this.card).find(".tpRelatedHeader").outerHeight() - $pdk.jQuery(this.card).find(".tpRelatedFooter").outerHeight();
    var tileHeight = 0;
    var originalWidth = 0;

    var tiles = $pdk.jQuery(this.card).find(".tpRelatedTile");

    for (var i=0; i<tiles.length; i++)
    {
        tileHeight = Math.floor(Math.max(tileHeight, $pdk.jQuery(tiles[i]).outerHeight()));
        originalWidth = Math.floor(Math.max(originalWidth, $pdk.jQuery(tiles[i]).outerWidth()));
    }

    if (tileHeight > regionHeight)
    {
        tiles.css("height", (regionHeight - 4) + "px");
        tiles.find("img").css("width", "");
        tiles.find("img").css("height", regionHeight-6);
        var newWidth = (regionHeight - 4) * originalWidth / tileHeight;
        tiles.css("padding-right", Math.floor((originalWidth - newWidth - 2)/2) + "px");
        tiles.css("padding-left", Math.floor((originalWidth - newWidth - 2)/2) + "px");
    }

    // since the tile was resized, let's find the height again...
    tileHeight = 0;

    for (var i=0; i<tiles.length; i++)
    {
        tileHeight = Math.floor(Math.max(tileHeight, $pdk.jQuery(tiles[i]).innerHeight()));
        originalWidth = Math.floor(Math.max(originalWidth, $pdk.jQuery(tiles[i]).outerWidth()));
    }

    tiles.css("margin-top", ((regionHeight - tileHeight) / 2) + "px");

    // this is a webkit hack to prevent delayed refresh
    tiles.css("display", "none");
    tiles.attr('offsetHeight');
    tiles.css("display", "inline-block");

    if (this.is_touch_device)
    {
        tiles.find(".tpRelatedInfo").css("height", (tileHeight-8) + "px");
    }

}

$pdk.cards.presenters.tpMenuCardPresenter.prototype.showRelatedItems = function(entries, total)
{
    var tiles = $pdk.jQuery(this.card).find('.tpRelatedTiles');
    var tile;
    //		var next = $pdk.jQuery(this.card).find('.tpRelatedNext');

    var regionHeight = $pdk.jQuery(this.card).find(".tpRelatedItems").outerHeight() - $pdk.jQuery(this.card).find(".tpRelatedHeader").outerHeight() - $pdk.jQuery(this.card).find(".tpRelatedFooter").outerHeight();
    var tileHeight = 0;
    var me = this;

    tiles.empty();

    for (var i=0; i<total; i++)
    {
        if (i < entries.length)
        {
            tile = this.createRelatedTile(entries[i], total);
        }
        else
        {
            tile = this.createRelatedTile(null, total);
        }

        tiles.append(tile);
        tileHeight = Math.max(tileHeight, $pdk.jQuery(tile).outerHeight());
    }

    if (this.rangeStart == 1)
    {
        $pdk.jQuery(this.card).find(".tpRelatedPrevious>div").css("opacity", "0.5");
        $pdk.jQuery(this.card).find(".tpRelatedPrevious>div").css("pointer-events", "none");
    }
    else
    {
        $pdk.jQuery(this.card).find(".tpRelatedPrevious>div").css("opacity", "1.0");
        $pdk.jQuery(this.card).find(".tpRelatedPrevious>div").css("pointer-events", "auto");
    }

    if (this.rangeStart+this.itemsPerPage-1 >= this.totalItems)
    {
        $pdk.jQuery(this.card).find(".tpRelatedNext>div").css("opacity", "0.5");
        $pdk.jQuery(this.card).find(".tpRelatedNext>div").css("pointer-events", "none");
    }
    else
    {
        $pdk.jQuery(this.card).find(".tpRelatedNext>div").css("opacity", "1.0");
        $pdk.jQuery(this.card).find(".tpRelatedNext>div").css("pointer-events", "auto");
    }

    var rangeStr = this.initVars.range.replace(/{start}/gi, this.rangeStart).replace(/{end}/gi, Math.min(this.rangeStart+this.itemsPerPage-1, this.totalItems)).replace(/{total}/gi, this.totalItems);

    $pdk.jQuery(this.card).find(".tpRange").text(rangeStr)
    $pdk.jQuery(this.card).find(".tpRelatedTile").css("margin-top", ((regionHeight - tileHeight) / 2) + "px");
    $pdk.jQuery(this.card).find(".tpRelatedNext, .tpRelatedPrevious").css("margin-top", ((regionHeight - 30) / 2) + "px");
}

$pdk.cards.presenters.tpMenuCardPresenter.prototype.createRelatedTile = function(entry, total)
{
    var tile = document.createElement("div");
    var a = document.createElement("a");
    var img = document.createElement("img");

    if (this.is_touch_device)
    {
        var info = document.createElement("div");
        info.className = "tpRelatedInfo";
        info.style.height = "0px";
    }

    var me = this;

    img.style.opacity = 0;

    if (entry && entry.media$content[0].plfile$url)
    {
        a.href="#";
        $pdk.jQuery(a).click(function() {
            me.initVars.controller.hidePlayerCard('forms', 'tpMenuCard');
            me.initVars.controller.setReleaseURL(entry.media$content[0].plfile$url, true, [me.initVars.player.id]);
            return false;
        })
    }

    if (!this.is_touch_device && entry && entry.title)
    {
        $pdk.jQuery(a).hover(
                /* MouseIn */
                function() {
                    $pdk.jQuery(me.card).find(".tpRelatedFooter .tpTitle").text(entry.title);
                },
                /* MouseOut */
                function() {
                    $pdk.jQuery(me.card).find(".tpRelatedFooter .tpTitle").text('');
                }
        );
    }

    a.appendChild(img);
    if (entry && entry.plmedia$defaultThumbnailUrl)
    {
        $pdk.jQuery(img).load(function(e) {
            e.target.style.opacity = null;
            me.centerTiles();
        })

        img.src = entry.plmedia$defaultThumbnailUrl;
    }
    else
    {
        me.centerTiles();
    }
    if (entry && (entry.title || entry.description))
    {
        if (this.is_touch_device)
        {
            a.appendChild(info);
            if (this.initVars.title)
            {
                var title = this.initVars.title;
                title = title.replace(/\{release\.title\}/gi, entry.title);
                title = title.replace(/\{release\.description\}/gi, entry.description);
                $pdk.jQuery(info).html(title);
                var fade = document.createElement("div");
                fade.className = "tpLineFade";
                info.appendChild(fade);
            }
            else
            {
                $pdk.jQuery(info).text(entry.title);
            }
        }
    }

    tile.appendChild(a);

    tile.className = "tpRelatedTile";

    if (this.is_touch_device)
    {
        info.style.width = (($pdk.jQuery(this.initVars.card).width() - 60 - 10*total - 10) / total - 2)/2 - 10 + "px";
        img.style.width = (($pdk.jQuery(this.initVars.card).width() - 60 - 10*total - 10) / total - 2)/2 + "px";
        $pdk.jQuery(tile).find(".tpLineFade").css("width", info.style.width);
    }
    else
    {
        img.style.width = Math.floor(($pdk.jQuery(this.initVars.card).width() - 60 - 10*total - 10) / total - 3) + "px";
    }

    return tile;
}

$pdk.cards.presenters.tpMenuCardPresenter.prototype.nextRange = function()
{
    if (this.rangeStart <  (this.totalItems - this.itemsPerPage + 1))
    {
        $pdk.jQuery(this.card).find('.tpRelatedTile img').css('opacity', '0');
        this.rangeStart += this.itemsPerPage;
        this.requestRelatedFeed();
    }
}

$pdk.cards.presenters.tpMenuCardPresenter.prototype.previousRange = function()
{
    if (this.rangeStart > this.itemsPerPage)
    {
        this.rangeStart -= this.itemsPerPage;
        this.requestRelatedFeed();
    }
}

$pdk.cards.presenters.tpMenuCardPresenter.prototype.hideRelatedUI = function()
{
    $pdk.jQuery(this.card).find('.tpRelatedItems').hide();
    var buttons = $pdk.jQuery(this.card).find('.tpMenuButtons');
    buttons.removeClass("tpHasRelated"); //css("top", "33%");
}

$pdk.cards.presenters.tpMenuCardPresenter.prototype.requestRelatedFeed = function()
{
    var me = this;
    var request = $pdk.util.getXMLHttpRequestObject();
    var delimiter = "?";

    if (this.relatedFeed.indexOf("?") >= 0)
    {
        delimiter = "&";
    }

    var feedUrl = this.relatedFeed + delimiter + "range=" + this.rangeStart + "-" + (this.rangeStart + this.itemsPerPage - 1) + "&count=true";
    feedUrl = $pdk.util.Strings.doUrlSubstitutions(feedUrl, this.initVars)

    if (feedUrl.indexOf("form=") >= 0)
    {
        feedUrl = feedUrl.replace(/([\&\?])form=[^\&\?]+/, "\\$1form=json");
    }
    else
    {
        feedUrl += "&form=json";
    }

    var formatArr = $pdk.env.Detect.getInstance().getPreferredFormats();
    var formats = "";

    for (var i=0; i<formatArr.length; i++)
    {
        formats += ( formats.length > 0 ? "|" : "" ) + formatArr[i];
    }

    if (formats)
    {
        feedUrl += "&byContent=byFormat%3D" + formats;
    }

    var onload = function() {
        if (this.responseText && this.responseText.length && this.readyState == 4) {
            if (this.responseText && this.responseText.length && this.status == 200) {
                var json = JSON.parse(request.responseText);
                me.totalItems = parseInt(json.totalResults);
                var entries = json.entries;
                if (entries && entries.length > 0)
                {
                    me.showRelatedItems(entries, me.itemsPerPage);
                }
                else
                {
                    me.hideRelatedUI();
                }
            } else {
                me.hideRelatedUI();
                if (self.console)
                    window.tpDebug("HTTP error " + request.status + ": " + request.statusText, "cards", "tpMenuCardPresenter", "error");
            }
        }
    }

    if ($pdk.isIE)
    {
        request.onload = onload;
    }
    else
    {
        request.onreadystatechange = onload;
    }

    // IE requires a setTimeout here
    setTimeout(function() {
        request.open("GET", feedUrl);
        request.send(null);
    }, 10);
}

$pdk.cards.presenters.tpMenuCardPresenter.prototype.initialize = function(initVars)
{
    var me = this;

    this.is_touch_device = 'ontouchstart' in document.documentElement;

    $pdk.jQuery(this.card).find('.tpRelatedNext').click(function(e) {
        me.nextRange();
    });

    $pdk.jQuery(this.card).find('.tpRelatedPrevious').click(function(e) {
        me.previousRange();
    });

    this.initialized = true;
}

$pdk.cards.presenters.tpMenuCardPresenter.prototype.show = function(initVars)
{

    this.card = initVars.card;
    this.initVars = initVars;
    this.initialize(initVars);

    var me = this;
    this.$tpBlocker = $pdk.jQuery(this.card).parents(".tpPlayer").find(".tpBlocker");
    this.$tpBlocker.css("opacity", 0.5);
    this.$tpBlocker.css("display", "");

    if ((initVars.player.playerurl === undefined && initVars.player.embeddedplayerhtml === undefined) ||
            (initVars.player.allowlink === "false" && initVars.player.emailserviceurl === undefined && initVars.player.embeddedplayerhtml === undefined))
    {
        $pdk.jQuery(this.card).find(".tpShare").remove();
    }

    if (initVars.player.rssurl === undefined || initVars.player.allowrss === "false")
    {
        $pdk.jQuery(this.card).find(".tpRSS").remove();
    }

    $pdk.jQuery(this.card).find(".tpShare").click(function() {
        if((window.fullScreen) || (window.innerWidth == screen.width && window.innerHeight > (screen.height-100)))
        {
            me.initVars.controller.showFullScreen(false);
            setTimeout(function() {
                me.initVars.controller.showPlayerCard('forms', 'tpShareCard');
            }, 1500);
        }
        else
        {
            me.initVars.controller.showPlayerCard('forms', 'tpShareCard');
        }
    });

    $pdk.jQuery(this.card).find(".tpRSS").click(function() {
        if((window.fullScreen) || (window.innerWidth == screen.width && window.innerHeight > (screen.height-100)))
        {
            me.initVars.controller.showFullScreen(false);
            setTimeout(function() {
                me.initVars.controller.showPlayerCard('forms', 'tpRssCard');
            }, 1500);
        }
        else
        {
            me.initVars.controller.showPlayerCard('forms', 'tpRssCard');
        }
    });

    $pdk.jQuery(this.card).find(".tpInfo").click(function() {

        if((window.fullScreen) || (window.innerWidth == screen.width && window.innerHeight > (screen.height-100)))
        {
            me.initVars.controller.showFullScreen(false);
            setTimeout(function() {
                me.initVars.controller.showPlayerCard('forms', 'tpInfoCard');
            }, 1500);
        }
        else
        {
            me.initVars.controller.showPlayerCard('forms', 'tpInfoCard');
        }
    });

    if (initVars.player.relateditemsurl)
    {

        var buttons = $pdk.jQuery(this.card).find('.tpMenuButtons');
        buttons.addClass("tpHasRelated"); //css("top", "33%");

        this.rangeStart = 1;
        this.itemsPerPage = parseInt(initVars.itemsPerPage) ? parseInt(initVars.itemsPerPage) : 6;

        // we can only fit 6 if we use hovering to display the title
        // so on touch devices with divide this by 3
        if (this.is_touch_device)
        {
            // make the related items area bigger, to handle small screens
            $pdk.jQuery(this.card).find(".tpRelatedItems").css("height", "50%");

            this.itemsPerPage = Math.ceil(this.itemsPerPage / 3);

            if (this.itemsPerPage < 2) this.itemsPerPage = 2;

            $pdk.jQuery(this.card).find(".tpRelatedFooter").hide();
            $pdk.jQuery(this.card).find(".tpRelatedFooter").css("height", "0px");
        }

        this.relatedFeed = initVars.player.relateditemsurl;

        this.requestRelatedFeed();
    }
    else
    {
        this.hideRelatedUI();
    }
}

$pdk.cards.presenters.tpMenuCardPresenter.prototype.hide = function()
{
    if (this.$tpBlocker)
    {
        this.$tpBlocker.css("opacity", "");
        this.$tpBlocker.css("display", "none");
    }
}

$pdk.cards.presenters.tpShareCardRedirectPresenter = function() {
};
$pdk.cards.presenters.tpShareCardRedirectPresenter.prototype.show = function(initVars){
    initVars.controller.showPlayerCard("forms", "tpShareCard", initVars.area, {formId: this.formId});
};
$pdk.cards.presenters.tpShareCardRedirectPresenter.prototype.hide = function(){
};

$pdk.cards.presenters.tpShareCardPostFormPresenter = function(){
    this.formId = "tpPostForm";
};
$pdk.cards.presenters.tpShareCardPostFormPresenter.prototype = new $pdk.cards.presenters.tpShareCardRedirectPresenter();
$pdk.cards.presenters.tpShareCardPostFormPresenter.prototype.constructor = $pdk.cards.presenters.tpShareCardPostFormPresenter;

$pdk.cards.presenters.tpShareCardLinkFormPresenter = function(){
    this.formId = "tpLinkForm";
};
$pdk.cards.presenters.tpShareCardLinkFormPresenter.prototype = new $pdk.cards.presenters.tpShareCardRedirectPresenter();
$pdk.cards.presenters.tpShareCardLinkFormPresenter.prototype.constructor = $pdk.cards.presenters.tpShareCardLinkFormPresenter;

$pdk.cards.presenters.tpShareCardEmbedFormPresenter = function(){
    this.formId = "tpEmbedForm";
};
$pdk.cards.presenters.tpShareCardEmbedFormPresenter.prototype = new $pdk.cards.presenters.tpShareCardRedirectPresenter();
$pdk.cards.presenters.tpShareCardEmbedFormPresenter.prototype.constructor = $pdk.cards.presenters.tpShareCardEmbedFormPresenter;

$pdk.cards.presenters.tpShareCardEmailFormPresenter = function(){
    this.formId = "tpEmailForm";
};
$pdk.cards.presenters.tpShareCardEmailFormPresenter.prototype = new $pdk.cards.presenters.tpShareCardRedirectPresenter();
$pdk.cards.presenters.tpShareCardEmailFormPresenter.prototype.constructor = $pdk.cards.presenters.tpShareCardEmailFormPresenter;

$pdk.cards.presenters.tpRssCardPresenter = function() {
}

$pdk.cards.presenters.tpRssCardPresenter.prototype.selectTextToCopy = function() {
    var content = "";

    content = $pdk.jQuery(this.card).find(".tpCopyable")[0];

    var sel = window.getSelection();
    var r = document.createRange();
    r.setStart(content.firstChild, 0);
    r.setEnd(content.firstChild, $pdk.jQuery(content).text().length);
    if (!$pdk.isIE)
        sel.removeAllRanges();
    sel.addRange(r);
}

$pdk.cards.presenters.tpRssCardPresenter.prototype.initialize = function(initVars)
{
    this.initVars = initVars;
    $pdk.jQuery(".tpCardClose .tpButton").click(function()
    {
        initVars.controller.hidePlayerCard("forms", "tpRssCard");
    });
}

$pdk.cards.presenters.tpRssCardPresenter.prototype.initSelection = function()
{
    var me = this;

    setTimeout(function() {
        me.selectTextToCopy();
    }, 100)

    $pdk.jQuery(this.card).find(".tpFormActions .tpButton").click(function() {
        // IE cannot handle selecting text while the mouse button is being released, so we have to wait a half a second...
        var timeout = ($pdk.isIE ? 500 : 1);

        setTimeout(function() {
            me.selectTextToCopy();
        }, timeout);
    });
}

$pdk.cards.presenters.tpRssCardPresenter.prototype.initInstructions = function()
{
    // change Ctrl-C to Command-C if on Desktop mac
    if (this.is_touch_device)
    {
        $pdk.jQuery(this.card).find(".tpInstructions").html(this.initVars.mobileInstructions)
        $pdk.jQuery(this.card).find(".tpFormActions .tpButton").hide();
    }
    else if (navigator.userAgent.indexOf("Mac OS X") != -1)
    {
        $pdk.jQuery(this.card).find(".tpInstructions").html($pdk.jQuery(this.card).find(".tpInstructions").html().replace("Ctrl-C", "&#8984;-C"))
    }
}

$pdk.cards.presenters.tpRssCardPresenter.prototype.initForm = function()
{
    this.initSelection();
    this.initInstructions();
    var link = $pdk.util.Strings.doUrlSubstitutions($pdk.jQuery(this.card).find(".tpCopyable").html(), this.initVars);
    $pdk.jQuery(this.card).find(".tpCopyable").html(link);
}

$pdk.cards.presenters.tpRssCardPresenter.prototype.show = function(initVars)
{
    this.is_touch_device = 'ontouchstart' in document.documentElement;
    this.card = initVars.card;
    this.initialize(initVars);
    this.initForm();
}

$pdk.cards.presenters.tpRssCardPresenter.prototype.hide = function()
{

}

$pdk.cards.presenters.tpShareCardPresenter = function() {
}

$pdk.cards.presenters.tpShareCardPresenter.prototype.showForm = function(formId)
{
    this.initVars.formId = formId;

    // show all tabs and start over
    $pdk.jQuery(this.card).find(".tpCardTabs > div").css("display", "inline-block");

    // hide all forms & selected tabs
    $pdk.jQuery(this.card).find(".tpCardForm > div").css("display", "none");
    $pdk.jQuery(this.card).find(".tpCardTabs > div[tp\\:selected='true']").css("display", "none");

    // show the selected form & tab
    $pdk.jQuery(this.card).find(".tpCardForm > div." + formId).css("display", "block");
    this.form = $pdk.jQuery(this.card).find(".tpCardForm > div." + formId)[0];

    // hide both versions of this icon
    $pdk.jQuery(this.card).find(".tpCardTabs > div[href='#" + formId + "']").css("display", "none");

    // then show the one that is selected
    $pdk.jQuery(this.card).find(".tpCardTabs > div[href='#" + formId + "']").filter("[tp\\:selected='true']").css("display", "inline-block");

    this.initForm();

    if ($pdk.jQuery(this.form).find("ul").length > 0 && $pdk.jQuery(this.form).find("ul")[0].scrollHeight > $pdk.jQuery(this.form).find("ul").innerHeight())
    {
        $pdk.jQuery(this.form).find("ul").css("overflow-y", "auto");
    }
}

$pdk.cards.presenters.tpShareCardPresenter.prototype.addTabHandlers = function()
{
    var me = this;

    var tabs = $pdk.jQuery(this.card).find(".tpCardTabs > div").not("div[tp\\:selected='true']");
    for (var i=0; i<tabs.length; i++)
    {
        $pdk.jQuery(tabs[i]).click(function(e) {
            me.showForm($pdk.jQuery(this).attr("href").substring(1));
        })
    }
}

$pdk.cards.presenters.tpShareCardPresenter.prototype.selectTextToCopy = function() {
    var content = "";

    content = $pdk.jQuery(this.form).find(".tpCopyable")[0];

    var sel = window.getSelection();
    var r = document.createRange();
    r.setStart(content.firstChild, 0);
    r.setEnd(content.firstChild, $pdk.jQuery(content).text().length);
    if (!$pdk.isIE)
        sel.removeAllRanges();
    sel.addRange(r);
}

$pdk.cards.presenters.tpShareCardPresenter.prototype.postToSite = function(site)
{
    for (var i=0; i<this.sites.length; i++)
    {
        if (this.sites[i].id == site)
        {
            var url =this.sites[i].postUrl;

            if (url.indexOf("{status}") >= 0)
            {
                url = url.replace(/\{status\}/gi, "Watching+{title}+{playerUrl}");
            }

            if (url.indexOf("{title}") >= 0)
            {
                //this must need url escaping, though
                url = url.replace(/\{title\}/gi, encodeURI(this.initVars.release.title));
            }

            // add tags from clip.baseClip.contentCustomData['tags']

            this.start = parseInt($pdk.jQuery(this.card).find(".tpExcerptControls").attr("tp:start"))/1000;

            url = $pdk.util.Strings.doUrlSubstitutions(url, this.initVars, this.start);

            window.open(url, "Post", "width=600,height=400,location=no,status=no,toolbar=no");
            this.initVars.controller.dispatchEvent("OnPost", {sharingSiteId: site, clip: this.initVars.clip, excerpt: {start: this.start, end: this.end, clip: this.initVars.clip}});
        }
    }
}

$pdk.cards.presenters.tpShareCardPresenter.prototype.initialize = function(initVars)
{
    var post, link, embed, email;
    post = link = embed = email = true;

    $pdk.jQuery(".tpCardClose .tpButton").click(function(e)
    {
        initVars.controller.hidePlayerCard("forms", "tpShareCard");
    })

    this.initVars = initVars;

    if (initVars.player.playerurl === undefined || initVars.player.allowlink === "false")
    {
        $pdk.jQuery(this.card).find(".tpCardTabs .tpNavButton[href=#tpLinkForm]").remove();
        $pdk.jQuery(this.card).find(".tpCardTabs .tpNavButton[href=#tpPostForm]").remove();
        link = false;
        post = false;
        if (initVars.formId == "tpLinkForm" || initVars.formId == "tpPostForm") initVars.formId = null;
    }

    if (initVars.player.embeddedplayerhtml === undefined || initVars.player.allowembed === "false")
    {
        $pdk.jQuery(this.card).find(".tpCardTabs .tpNavButton[href=#tpEmbedForm]").remove();
        embed = false;
        if (initVars.formId == "tpEmbedForm") initVars.formId = null;
    }

    if (initVars.player.emailserviceurl === undefined || initVars.player.playerurl === undefined)
    {
        $pdk.jQuery(this.card).find(".tpCardTabs .tpNavButton[href=#tpEmailForm]").remove();
        email = false;
        if (initVars.formId == "tpEmailForm") initVars.formId = null;
    }

    if (!initVars.formId)
    {
        if (post)
        {
            initVars.formId = "tpPostForm";
        }
        else if (link)
        {
            initVars.formId = "tpLinkForm";
        }
        else if (email)
        {
            initVars.formId = "tpEmailForm";
        }
        else if (embed)
        {
            initVars.formId = "tpEmbedForm";
        }
        else
        {
            initVars.controller.showPlayerCard("forms", "tpMenuCard");
        }
    }

    if (!initVars.clip || !initVars.clip.baseClip || initVars.clip.isAd || initVars.clip.baseClip.isAd || navigator.userAgent.match(/Phone/i))
    {
        initVars.excerpts = false;
    }

    if (!initVars.excerpts)
    {
        $pdk.jQuery(this.card).find(".tpPreview").remove();
        $pdk.jQuery(this.card).find(".tpCardExtras").remove();
        $pdk.jQuery(this.card).find(".tpCardForm").css("width", "100%").css("height", "100%");
    }
    else
    {
        var ratio = $pdk.jQuery(this.card).width() / $pdk.jQuery(this.card).height();
        var pixelWidth = $pdk.jQuery(this.card).find(".tpPreview").outerHeight() * ratio;
        var percentWidth = Math.floor(100 * (pixelWidth / $pdk.jQuery(this.card).width()));
        $pdk.jQuery(this.card).find(".tpPreview").css("width", percentWidth + "%");
        $pdk.jQuery(this.card).find(".tpCardForm").css("width", (100-percentWidth) + "%");
    }
}

$pdk.cards.presenters.tpShareCardPresenter.prototype.initSelection = function()
{
    var me = this;

    setTimeout(function() {
        me.selectTextToCopy();
    }, 100)

    $pdk.jQuery(this.form).find(".tpFormActions .tpButton").click(function() {
        // IE cannot handle selecting text while the mouse button is being released, so we have to wait a half a second...
        var timeout = ($pdk.isIE ? 500 : 1);

        setTimeout(function() {
            me.selectTextToCopy();
        }, timeout);
    });
}

$pdk.cards.presenters.tpShareCardPresenter.prototype.initInstructions = function(instructions)
{
    // change Ctrl-C to Command-C if on Desktop mac
    if (this.is_touch_device)
    {
        $pdk.jQuery(this.form).find(".tpInstructions").html(instructions)
        $pdk.jQuery(this.form).find(".tpFormActions .tpButton").hide();
    }
    else if (navigator.userAgent.indexOf("Mac OS X") != -1)
    {
        $pdk.jQuery(this.form).find(".tpInstructions").html($pdk.jQuery(this.form).find(".tpInstructions").html().replace("Ctrl-C", "&#8984;-C"))
    }
}

$pdk.cards.presenters.tpShareCardPresenter.prototype.initSharingSites = function()
{
    var enabledSites = (this.initVars.player.sharingsiteids ? this.initVars.player.sharingsiteids.split(",") : ["facebook", "twitter", "tumblr", "googleplus", "digg", "reddit"]);
    var me = this;


// old:
// "http://twitter.com/home?status={status}"

// new:
// "https://twitter.com/intent/tweet?url={playerURL}&text=Watching+{title}"

    me.sites = [
        {id: "facebook", title: "Facebook", icon: 'images/icons/facebook.png', postUrl: "http://www.facebook.com/sharer.php?u={playerURL}&t={title}"},
        {id: "twitter", title: "Twitter", icon: 'images/icons/twitter.png', postUrl: "http://twitter.com/intent/tweet?url={playerURL}&text=Watching+{title}"},
        {id: "tumblr", title: "Tumblr", icon: 'images/icons/tumblr.png', postUrl: "http://www.tumblr.com/share/video?caption={title}&embed={embeddedPlayerHTML}"},
        {id: "googleplus", title: "Google+", icon: 'images/icons/googlePlus.png', postUrl: "https://plus.google.com/share?url={playerURL}"},
        {id: "reddit", title: "Reddit", icon: 'images/icons/reddit.png', postUrl: "http://reddit.com/submit?url={playerURL}&title={title}"},
        {id: "digg", title: "Digg", icon: 'images/icons/digg.png', postUrl: "http://digg.com/submit?phase=2&url={playerURL}&title={title}&bodytext={description}&media=video"},
        {id: "delicious", title: "Delicious", icon: 'images/icons/delicious.png', postUrl: "http://del.icio.us/post?url={playerURL}&title={title}&notes={description}"},
        {id: "stumbleupon", title: "StumbleUpon", icon: 'images/icons/stumbleUpon.png', postUrl: "http://www.stumbleupon.com/submit?url={playerURL}&title={title}"},
        {id: "myspace", title: "MySpace", icon: 'images/icons/mySpace.png', postUrl: "http://www.myspace.com/Modules/PostTo/Pages/?t={title}&c={embeddedPlayerHTML}&u={playerURL}&l=4"},
        {id: "vodpod", title: "VodPod", icon: 'images/icons/vodpod.png', postUrl: "http://vodpod.com/savevideo/popup?t={title}&d={description}&embed={embeddedPlayerHTML}&p={playerURL}&source=theplatform&site={site}"},
        {id: "windowslive", title: "Windows Live", icon: 'images/icons/windowsLive.png', postUrl: "http://skydrive.live.com/quickadd.aspx?title={title}&mkt=en-us&url={playerURL}&marklet=1"}
    ];

    // make built in icons relative to PDK
    for (var i=0; i<me.sites.length; i++)
    {
        if (me.sites[i].icon.indexOf("http://") != 0 && me.sites[i].icon.indexOf("https://") != 0)
        {
            me.sites[i].icon = $pdk.scriptRoot + "/" + me.sites[i].icon;
        }
    }

    var site, id, title, icon, url, spliced, siteObject;

    for (var key in me.initVars.player)
    {
        if (key.toLowerCase() !== "sharingsiteids" && key.toLowerCase().indexOf("sharingsite") == 0)
        {
            spliced = false;
            site = me.initVars.player[key].split("|");
            if (site.length >= 4)
            {
                id = site[0];
                title = site[1];
                icon = site[2];
                url = site[3];

                siteObject = {id: id, title: title, icon: icon, postUrl: url};

                for (var i=0; i<me.sites.length; i++)
                {
                    if (me.sites[i].id == id)
                    {
                        me.sites.splice(i, 1, siteObject);
                        spliced = true;
                        break;
                    }
                }
            }

            if (!spliced)
            {
                me.sites.push(siteObject);
            }
        }
    }

    $pdk.jQuery(me.card).find(".tpPostSiteList").empty();

    var iconUrl, i;

    for (var j=0; j<enabledSites.length; j++)
    {
        for (var i=0; i<me.sites.length; i++)
        {
            if (me.sites[i].id == enabledSites[j])
            {
                iconUrl = me.sites[i].icon;

                $pdk.jQuery(me.card).find(".tpPostSiteList").append("<li><a href='#" + me.sites[i].id + "'><img src='" + iconUrl + "'/>" + me.sites[i].title + "</a></li>");
            }
        }
    }

    // if the form is small, don't use two columns...
    if ($pdk.jQuery(me.card).width() < 400)
    {
        $pdk.jQuery(me.card).find(".tpPostSiteList li").css("width", "100%");
    }

    $pdk.jQuery(me.card).find(".tpPostSiteList li a").click(function(e) {
        me.postToSite(this.href.split("#")[1]);
        return false;
    })
}

$pdk.cards.presenters.tpShareCardPresenter.prototype.initEmailForm = function()
{
    var me = this;

    $pdk.jQuery(me.form).find(".tpFormActions .tpSend").click(function(e) {

        var request = $pdk.util.getXMLHttpRequestObject();
        var emailUrl = $pdk.util.Strings.doUrlSubstitutions(me.initVars.player.emailserviceurl, me.initVars);
        var params = "";
        var fromAddr = $pdk.jQuery(me.card).find(".tpEmailFrom").attr("value");
        var toAddr = $pdk.jQuery(me.card).find(".tpEmailTo").attr("value");

        me.start = parseInt($pdk.jQuery(me.card).find(".tpExcerptControls").attr("tp:start"))/1000;

        params += "releaseTitle=" + escape(me.initVars.release.title);
        params += "&message=" + escape($pdk.jQuery(me.card).find(".tpEmailMessage").attr("value"));
        params += "&from=" + escape(fromAddr);
        params += "&to=" + escape(toAddr);
        params += "&releaseDescription=" + escape(me.initVars.release.description);
        params += "&playerURL=" + escape($pdk.util.Strings.doUrlSubstitutions(me.initVars.player.playerurl, me.initVars, me.start));

        request.onreadystatechange = function() {
            if (request.readyState == 4) {
                if (request.status == 200) {
                    // email sent
                    var json = JSON.parse(request.responseText);
                    if (json.isException)
                    {
                        me.initVars.controller.showPlayerCard("forms", "tpErrorCard", "urn:theplatform:pdk:area:player", {title: 'Error sending email', message: json.message});
                    }
                    else
                    {
                        me.initVars.controller.dispatchEvent("OnEmail", {recipientCount: 1, clip: me.initVars.clip, excerpt: {start: me.start, end: me.end, clip: me.initVars.clip}});
                        me.initVars.controller.hidePlayerCard("forms", "tpEmailCard");
                    }
                }
                else {
                    me.initVars.controller.showPlayerCard("forms", "tpErrorCard", "urn:theplatform:pdk:area:player", {title: 'Error sending email', message: 'There was an error connecting to the email service: ' + request.status + ' - ' + request.statusText});
                }
            }
        }

        request.open("POST", emailUrl, true);

        //Send the proper header information along with the request
        if (window.XMLHttpRequest)
        {
            request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        }

        request.send(params);
    })

    $pdk.jQuery(me.card).find(".tpFormActions .tpCancel").click(function(e) {
        me.initVars.controller.hidePlayerCard('forms', 'tpEmailCard');
    })

    $pdk.jQuery(me.card).find(".tpEmailTo").focus(function(e) {
        if ($pdk.jQuery(me.card).find(".tpEmailTo").val() === me.initVars.to) {
            $pdk.jQuery(me.card).find(".tpEmailTo").val("");
        }
    });

    $pdk.jQuery(me.card).find(".tpEmailTo").blur(function(e) {
        if ($pdk.jQuery(me.card).find(".tpEmailTo").val() === "") {
            $pdk.jQuery(me.card).find(".tpEmailTo").val(me.initVars.to);
        }
    });

    $pdk.jQuery(me.card).find(".tpEmailFrom").focus(function(e) {
        if ($pdk.jQuery(me.card).find(".tpEmailFrom").val() === me.initVars.from) {
            $pdk.jQuery(me.card).find(".tpEmailFrom").val("");
        }
    });

    $pdk.jQuery(me.card).find(".tpEmailFrom").blur(function(e) {
        if ($pdk.jQuery(me.card).find(".tpEmailFrom").val() === "") {
            $pdk.jQuery(me.card).find(".tpEmailFrom").val(me.initVars.from);
        }
    });

    $pdk.jQuery(me.card).find(".tpEmailMessage").focus(function(e) {
        if ($pdk.jQuery(me.card).find(".tpEmailMessage").val() === me.initVars.message) {
            $pdk.jQuery(me.card).find(".tpEmailMessage").val("");
        }
    });

    $pdk.jQuery(me.card).find(".tpEmailMessage").blur(function(e) {
        if ($pdk.jQuery(me.card).find(".tpEmailMessage").val() === "") {
            $pdk.jQuery(me.card).find(".tpEmailMessage").val(me.initVars.message);
        }
    });
}

$pdk.cards.presenters.tpShareCardPresenter.prototype.initForm = function()
{
    this.start = parseInt($pdk.jQuery(this.card).find(".tpExcerptControls").attr("tp:start"))/1000;

    if(this.clickHandler) {
        $pdk.jQuery(this.card).find(".tpExcerptControls").unbind('click', this.clickHandler);
        this.clickHandler = null;
    }

    if (this.initVars.formId == "tpPostForm")
    {
        this.initSharingSites();
    }
    else if (this.initVars.formId == "tpLinkForm")
    {
        try {


            var me = this;
            var populateLinkForm = function() {
                me.start = parseInt($pdk.jQuery(me.card).find(".tpExcerptControls").attr("tp:start"))/1000;
                $pdk.jQuery(me.form).find(".tpCopyable").text(me.initVars.player.playerurl);
                me.initSelection();
                me.initInstructions(me.initVars.mobileLink);
                var link = $pdk.util.Strings.doUrlSubstitutions($pdk.jQuery(me.form).find(".tpCopyable").html(), me.initVars, me.start);
                $pdk.jQuery(me.form).find(".tpCopyable").html(link);
            };
            populateLinkForm();

            this.clickHandler = function() {
                setTimeout(function() {
                    populateLinkForm();
                }, 500)
            };

            $pdk.jQuery(this.card).find(".tpExcerptControls").click(this.clickHandler);
        }
        catch(e)
        {

        }
    }
    else if (this.initVars.formId == "tpEmbedForm")
    {
        try {
            var me = this;
            var populateEmbedForm = function() {
                me.start = parseInt($pdk.jQuery(me.card).find(".tpExcerptControls").attr("tp:start"))/1000;
                $pdk.jQuery(me.form).find(".tpCopyable").text(me.initVars.player.embeddedplayerhtml);
                me.initSelection();
                me.initInstructions(me.initVars.mobileEmbed);
                var code = $pdk.util.Strings.doUrlSubstitutions($pdk.jQuery(me.form).find(".tpCopyable").html(), me.initVars, me.start);
                $pdk.jQuery(me.form).find(".tpCopyable").html(code);
            };
            populateEmbedForm();

            this.clickHandler = function() {
                setTimeout(function() {
                    populateEmbedForm();
                }, 500)
            };

            $pdk.jQuery(this.card).find(".tpExcerptControls").click(this.clickHandler);
        }
        catch(e){

        }
    }
    else if (this.initVars.formId == "tpEmailForm")
    {
        this.initEmailForm();
        var tpEmailMessage = $pdk.jQuery(this.card).find(".tpEmailForm .tpEmailMessage");
        var tpFormActions = $pdk.jQuery(this.card).find(".tpEmailForm .tpFormActions");
        var tpEmailForm = $pdk.jQuery(this.card).find(".tpEmailForm");
        tpEmailMessage.height(tpFormActions.position().top - tpEmailMessage.position().top - 6);
    }
}

$pdk.cards.presenters.tpShareCardPresenter.prototype.show = function(initVars)
{
    this.is_touch_device = 'ontouchstart' in document.documentElement;
    this.card = initVars.card;
    this.initialize(initVars);
    this.showForm(initVars.formId);
    this.addTabHandlers();
}

$pdk.cards.presenters.tpShareCardPresenter.prototype.hide = function()
{
}

$pdk.cards.presenters.tpInfoCardPresenter = function() {
}

$pdk.cards.presenters.tpInfoCardPresenter.prototype.show = function(initVars) {

    $pdk.jQuery(".tpCardClose .tpButton").click(function(e)
    {
        initVars.controller.hidePlayerCard("forms", "tpInfoCard");
    })

    if (initVars.showPreview == "true")
    {
        var preview = initVars.release.url;

        if (preview.indexOf("?"))
        {
            preview = preview.split("?")[0];
        }

        preview += "?format=poster&width=" + $pdk.jQuery(initVars.card).find(".tpMediaPreview").innerWidth() + "&height=" + $pdk.jQuery(initVars.card).find(".tpMediaPreview").innerHeight();

        if (initVars.assetType)
        {
            preview += "&assetType=" + initVars.assetType;
        }

        $pdk.jQuery(initVars.card).find(".tpMediaPreview img").attr('src', preview);
    }
    else
    {
        $pdk.jQuery(initVars.card).find(".tpMediaPreview").remove();
    }

    if (!$pdk.jQuery(initVars.card).find(".tpChapterTitle").text())
    {
        $pdk.jQuery(initVars.card).find(".tpChapterTitle").remove();
    }

    $pdk.jQuery(initVars.card).find(".tpCopyright").text($pdk.jQuery(initVars.card).find(".tpCopyright").text().replace("© ©", "©"));

    var ratings = [];

    for (var i=0; i<initVars.release.ratings.length; i++)
    {
        ratings.push(initVars.release.ratings[i].rating);
    }

    ratings = ratings.join(", ");

    if (ratings)
    {
        $pdk.jQuery(initVars.card).find(".tpRatings").html(ratings);
    }
    else
    {
        $pdk.jQuery(initVars.card).find(".tpRatings").remove();
    }

    var categories = [];

    for (var i=0; i<initVars.release.categories.length; i++)
    {
        categories.push(initVars.release.categories[i].name);
    }

    categories = categories.join(", ");

    if (categories)
    {
        $pdk.jQuery(initVars.card).find(".tpCategories").html(categories);
    }
    else
    {
        $pdk.jQuery(initVars.card).find(".tpCategories").remove();
    }

    if (!$pdk.jQuery(initVars.card).find(".tpAuthor").text())
    {
        $pdk.jQuery(initVars.card).find(".tpAuthor").remove();
    }

    var duration = new Date();
    var durationStr = "";
    duration.setHours(0);
    duration.setMinutes(0);
    duration.setSeconds(0);
    duration.setMilliseconds(parseInt($pdk.jQuery(initVars.card).find(".tpDuration").text()));

    if (!isNaN(duration.getHours())&&duration.getHours() > 0)
    {
        durationStr = duration.getHours() + ":" + (duration.getMinutes() < 10 ? "0" : "") + duration.getMinutes() + ":" + (duration.getSeconds() < 10 ? "0" : "") + duration.getSeconds();
    }
    else if (!isNaN(duration.getMinutes()))
    {
        durationStr =  duration.getMinutes() + ":" + (duration.getSeconds() < 10 ? "0" : "") + duration.getSeconds();
    }

    if (durationStr)
    {
        $pdk.jQuery(initVars.card).find(".tpDuration").html(durationStr);
    }
    else
    {
        $pdk.jQuery(initVars.card).find(".tpDuration").remove();
    }
}

$pdk.cards.presenters.tpInfoCardPresenter.prototype.hide = function()
{

}
$pdk.cards.presenters.tpErrorCardPresenter = function(){};
$pdk.cards.presenters.tpErrorCardPresenter.prototype.show = function(initVars)
{
    $pdk.jQuery(initVars.card).find(".tpCardClose .tpButton").click(function()
    {
        if (initVars.playNext === "true")
        {
            initVars.controller.callFunction("nextRelease", []);
        }
        initVars.controller.hidePlayerCard("forms", "tpErrorCard");
        return false;
    });
};
$pdk.cards.presenters.tpErrorCardPresenter.prototype.hide = function(initVars){};

$pdk.cards.presenters.tpLoginCardPresenter = function(){};
$pdk.cards.presenters.tpLoginCardPresenter.prototype.show = function(initVars)
{
    $pdk.jQuery(initVars.card).find(".tpUsername").attr("value", initVars.username);
    $pdk.jQuery(initVars.card).find(".tpPassword").attr("value", initVars.password);

    $pdk.jQuery(initVars.card).find(".tpCardClose .tpButton").click(function()
    {
        initVars.controller.dispatchEvent("OnLoginCancel");
        initVars.controller.hidePlayerCard("forms", "tpLoginCard");
        return false;
    });

    $pdk.jQuery(initVars.card).find(".tpFormActions .tpSubmit").click(function()
    {
        var un = $pdk.jQuery(initVars.card).find(".tpUsername").attr("value");
        var pw = $pdk.jQuery(initVars.card).find(".tpPassword").attr("value");
        initVars.controller.dispatchEvent("OnLoginSubmit",{username:un,password:pw});
        return false;
    });

    $pdk.jQuery(initVars.card).find(".tpFormActions .tpCancel").click(function()
    {
        initVars.controller.dispatchEvent("OnLoginCancel");
        initVars.controller.hidePlayerCard("forms", "tpLoginCard");
        return false;
    });
},
$pdk.cards.presenters.tpLoginCardPresenter.prototype.hide = function(){ }
</script>


<script type="text/javascript">
    $pdk.cards.addDefaultCards = function() {

        $pdk.cards.presenters.share_config = {
            title: 'Share',
            excerpts: true,

            post: "Post to a site",
            link: "Press Ctrl-C to copy the link",
            embed: "Press Ctrl-C to copy the code",
            mobileLink: "Tap and hold below to copy the link",
            mobileEmbed: "Tap and hold below to copy the code",
            send: 'Send',
            cancel: 'Cancel',
            select: 'Select Text',
            close: 'Close',
            label: 'Play or seek to adjust the time offset.',
            play: 'Play',
            pause: 'Pause',
            message: 'Message',
            to: 'Send to',
            from: 'Your Email'
        }

        $pdk.controller.addPlayerCard("forms", "tpMenuCard", document.getElementById("tpMenuCard"), "urn:theplatform:pdk:area:overlay", {share: 'Share', rss: 'RSS', info: 'Info', label: "Related Items", range: "{start} - {end} of {total}", title: "<h4>{release.title}</h4><span>{release.description}</span>"},  $pdk.cards.presenters.tpMenuCardPresenter, 100, ["*"]);
        $pdk.controller.addPlayerCard("forms", "tpRssCard", document.getElementById("tpRssCard"), "urn:theplatform:pdk:area:player", {title: 'RSS', instructions: "Press Ctrl-C to copy the RSS feed", mobileInstructions: "Select and copy the RSS feed below", select: 'Select Text', close: 'Close'},  $pdk.cards.presenters.tpRssCardPresenter, 100, ["*"]);
        $pdk.controller.addPlayerCard("forms", "tpErrorCard", document.getElementById("tpErrorCard"), "urn:theplatform:pdk:area:player", {title: "Error", message: "There was an error.", close: "Close"}, $pdk.cards.presenters.tpErrorCardPresenter, 100, ["*"]);
        $pdk.controller.addPlayerCard("forms", "tpShareCard", document.getElementById("tpShareCard"), "urn:theplatform:pdk:area:player", $pdk.cards.presenters.share_config,  $pdk.cards.presenters.tpShareCardPresenter, 100, ["*"]);
        $pdk.controller.addPlayerCard("forms", "tpPostCard", "<div></div>", "urn:theplatform:pdk:area:player", {},  $pdk.cards.presenters.tpShareCardPostFormPresenter, 100, ["*"]);
        $pdk.controller.addPlayerCard("forms", "tpLinkCard", "<div></div>", "urn:theplatform:pdk:area:player", {},  $pdk.cards.presenters.tpShareCardLinkFormPresenter, 100, ["*"]);
        $pdk.controller.addPlayerCard("forms", "tpEmbedCard", "<div></div>", "urn:theplatform:pdk:area:player", {},  $pdk.cards.presenters.tpShareCardEmbedFormPresenter, 100, ["*"]);
        $pdk.controller.addPlayerCard("forms", "tpEmailCard", "<div></div>", "urn:theplatform:pdk:area:player", {},  $pdk.cards.presenters.tpShareCardEmailFormPresenter, 100, ["*"]);
        $pdk.controller.addPlayerCard("forms", "tpInfoCard", document.getElementById("tpInfoCard"), "urn:theplatform:pdk:area:player", {title: 'Info', close: 'Close'},  $pdk.cards.presenters.tpInfoCardPresenter, 100, ["*"]);
        $pdk.controller.addPlayerCard("forms", "tpLoginCard", document.getElementById("tpLoginCard"), "urn:theplatform:pdk:area:player", {title: 'Log-in', usernameLabel: 'Username', passwordLabel: 'Password', close: 'Close', submit: 'Submit', cancel: 'Cancel'},  $pdk.cards.presenters.tpLoginCardPresenter, 100, ["*"]);

    }

    $pdk.cards.addDefaultCards();
    $pdk.controller.dispatchEvent("OnCardsLoaded", {});

</script>
</div>
<script type="text/javascript" src="./hls.min.js.descarga"></script></body></html>